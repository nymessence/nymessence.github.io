const c=document.getElementById("fractalCanvas"),I=c.getContext("2d"),S=document.getElementById("funcInput"),U=document.getElementById("cReal"),Z=document.getElementById("cImag"),_=document.getElementById("iterations"),$=document.getElementById("gradient"),ee=document.getElementById("resetView");let o=window.innerWidth,s=window.innerHeight;c.width=o;c.height=s;let f=0,g=0,a=4/o,u=!1,v={x:0,y:0},n={x:0,y:0},d={x:0,y:0},x=!1;const Y=document.createElement("canvas"),O=Y.getContext("2d");Y.width=o;Y.height=s;let D=!1,V=0,H=null,p=1,L={x:0,y:0},F=null;function A(e,t){const l=t.clientX-e.clientX,h=t.clientY-e.clientY;return Math.sqrt(l*l+h*h)}function G(e,t){return{x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}}function te(e){try{let t=e.replace(/\^/g,"**");return math.compile(t)}catch(t){return alert("Invalid formula: "+t),null}}function P(e){e=e.replace("#",""),e.length===3&&(e=e.split("").map(l=>l+l).join(""));const t=parseInt(e,16);return[t>>16&255,t>>8&255,t&255]}function ne(e,t){let l=[];for(let h=0;h<t;h++){let X=h/(t-1)*(e.length-1),M=Math.floor(X),B=Math.min(M+1,e.length-1),y=X-M,m=P(e[M]),r=P(e[B]);l.push([Math.round(m[0]+y*(r[0]-m[0])),Math.round(m[1]+y*(r[1]-m[1])),Math.round(m[2]+y*(r[2]-m[2]))])}return l}async function w(){x=!0;const e=te(S.value);if(!e){x=!1;return}const t=parseFloat(U.value),l=parseFloat(Z.value),h=parseInt(_.value),X=$.value.split(",").map(r=>r.trim()),M=ne(X,h+1),B=O.createImageData(o,s),y=B.data,m=50;for(let r=0;r<s;r+=m){const J=Math.min(r+m,s);for(let E=r;E<J;E++)for(let C=0;C<o;C++){let K=f+(C-o/2)*a,N=g+(E-s/2)*a,T=K,k=N,R=0;for(;R<h;){let Q={z:math.complex(T,k),c:math.complex(t,l)},q=e.evaluate(Q);if(T=q.re,k=q.im,T*T+k*k>4)break;R++}let W=M[R]||[0,0,0],z=4*(E*o+C);y[z]=W[0],y[z+1]=W[1],y[z+2]=W[2],y[z+3]=255}O.putImageData(B,0,0),await new Promise(E=>setTimeout(E,0))}x=!1,n.x=0,n.y=0}function i(e=1,t=0,l=0){I.clearRect(0,0,o,s),I.save(),I.translate(t,l),I.scale(e,e),I.drawImage(Y,0,0),I.restore()}c.addEventListener("mousedown",e=>{u=!0,v.x=e.clientX,v.y=e.clientY,d.x=f,d.y=g,x||(n.x=0,n.y=0)});c.addEventListener("mousemove",e=>{u&&(n.x=e.clientX-v.x,n.y=e.clientY-v.y,i(1,n.x,n.y))});c.addEventListener("mouseup",e=>{u&&(x||(f=d.x-n.x*a,g=d.y-n.y*a,n.x=0,n.y=0,w(),i()),u=!1)});c.addEventListener("mouseleave",()=>{u&&(x||(f=d.x-n.x*a,g=d.y-n.y*a,n.x=0,n.y=0,w(),i()),u=!1)});let b=1,j=null;c.addEventListener("wheel",e=>{e.preventDefault();const t=e.deltaY<0?.9:1.1;a/=t,b*=t,i(b),j&&clearTimeout(j),j=setTimeout(()=>{b=1,w(),i()},300)});c.addEventListener("touchstart",e=>{e.preventDefault(),e.touches.length===1?(u=!0,v.x=e.touches[0].clientX,v.y=e.touches[0].clientY,d.x=f,d.y=g,x||(n.x=0,n.y=0),D=!1):e.touches.length===2&&(u=!1,D=!0,V=A(e.touches[0],e.touches[1]),H=G(e.touches[0],e.touches[1]),p=1,L={x:0,y:0},F=H)});c.addEventListener("touchmove",e=>{if(e.preventDefault(),e.touches.length===1&&u)n.x=e.touches[0].clientX-v.x,n.y=e.touches[0].clientY-v.y,i(1,n.x,n.y);else if(e.touches.length===2&&D){const t=A(e.touches[0],e.touches[1]),l=G(e.touches[0],e.touches[1]);p=t/V,L.x+=l.x-F.x,L.y+=l.y-F.y,F=l,i(p,L.x,L.y)}});c.addEventListener("touchend",e=>{if(e.preventDefault(),u&&(x||(f=d.x-n.x*a,g=d.y-n.y*a,n.x=0,n.y=0,w(),i()),u=!1),D&&e.touches.length<2){const t=H.x-o/2,l=H.y-s/2;a/=p,f+=t*(a-a*p),g+=l*(a-a*p),p=1,L={x:0,y:0},D=!1,w(),i()}});ee.addEventListener("click",()=>{f=0,g=0,a=4/o,w(),i()});window.addEventListener("resize",()=>{o=window.innerWidth,s=window.innerHeight,c.width=o,c.height=s,Y.width=o,Y.height=s,a=4/o,w(),i()});window.addEventListener("DOMContentLoaded",()=>{w(),i()});
//# sourceMappingURL=fractal2.js.map
