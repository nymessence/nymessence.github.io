import"./modulepreload-polyfill.js";import{R as Tt,B as _t,z as Lt,N as bt,a as Mt,Z as nt,I as M,e as Pt,T as kt,f as Ot,Q as zt,g as At,O as St,h as Wt,i as Vt,F as It,j as Rt,k as Ut,l as Ht,U as ft,V as Bt,L as Xt,P as jt,m as Zt,n as Yt,H as qt,o as lt}from"./three.module2.js";import{X as gt}from"./OrbitControls2.js";const $=0,$t=1,Nt=new M,ct=new Pt,G=new kt,dt=new M,q=new Ot;class Dt{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new ht,this.unassigned=new ht,this.vertices=[]}setFromPoints(t){if(t.length>=4){this.makeEmpty();for(let e=0,o=t.length;e<o;e++)this.vertices.push(new Gt(t[e]));this._compute()}return this}setFromObject(t){const e=[];return t.updateMatrixWorld(!0),t.traverse(function(o){const s=o.geometry;if(s!==void 0){const i=s.attributes.position;if(i!==void 0)for(let r=0,a=i.count;r<a;r++){const c=new M;c.fromBufferAttribute(i,r).applyMatrix4(o.matrixWorld),e.push(c)}}}),this.setFromPoints(e)}containsPoint(t){const e=this.faces;for(let o=0,s=e.length;o<s;o++)if(e[o].distanceToPoint(t)>this.tolerance)return!1;return!0}intersectRay(t,e){const o=this.faces;let s=-1/0,i=1/0;for(let r=0,a=o.length;r<a;r++){const c=o[r],d=c.distanceToPoint(t.origin),u=c.normal.dot(t.direction);if(d>0&&u>=0)return null;const g=u!==0?-d/u:0;if(!(g<=0)&&(u>0?i=Math.min(g,i):s=Math.max(g,s),s>i))return null}return s!==-1/0?t.at(s,e):t.at(i,e),e}intersectsRay(t){return this.intersectRay(t,Nt)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}_addVertexToFace(t,e){return t.face=e,e.outside===null?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this}_removeVertexFromFace(t,e){return t===e.outside&&(t.next!==null&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this}_removeAllVerticesFromFace(t){if(t.outside!==null){const e=t.outside;let o=t.outside;for(;o.next!==null&&o.next.face===t;)o=o.next;return this.assigned.removeSubList(e,o),e.prev=o.next=null,t.outside=null,e}}_deleteFaceVertices(t,e){const o=this._removeAllVerticesFromFace(t);if(o!==void 0)if(e===void 0)this.unassigned.appendChain(o);else{let s=o;do{const i=s.next;e.distanceToPoint(s.point)>this.tolerance?this._addVertexToFace(s,e):this.unassigned.append(s),s=i}while(s!==null)}return this}_resolveUnassignedPoints(t){if(this.unassigned.isEmpty()===!1){let e=this.unassigned.first();do{const o=e.next;let s=this.tolerance,i=null;for(let r=0;r<t.length;r++){const a=t[r];if(a.mark===$){const c=a.distanceToPoint(e.point);if(c>s&&(s=c,i=a),s>1e3*this.tolerance)break}}i!==null&&this._addVertexToFace(e,i),e=o}while(e!==null)}return this}_computeExtremes(){const t=new M,e=new M,o=[],s=[];for(let i=0;i<3;i++)o[i]=s[i]=this.vertices[0];t.copy(this.vertices[0].point),e.copy(this.vertices[0].point);for(let i=0,r=this.vertices.length;i<r;i++){const a=this.vertices[i],c=a.point;for(let d=0;d<3;d++)c.getComponent(d)<t.getComponent(d)&&(t.setComponent(d,c.getComponent(d)),o[d]=a);for(let d=0;d<3;d++)c.getComponent(d)>e.getComponent(d)&&(e.setComponent(d,c.getComponent(d)),s[d]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(e.x))+Math.max(Math.abs(t.y),Math.abs(e.y))+Math.max(Math.abs(t.z),Math.abs(e.z))),{min:o,max:s}}_computeInitialHull(){const t=this.vertices,e=this._computeExtremes(),o=e.min,s=e.max;let i=0,r=0;for(let l=0;l<3;l++){const m=s[l].point.getComponent(l)-o[l].point.getComponent(l);m>i&&(i=m,r=l)}const a=o[r],c=s[r];let d,u;i=0,ct.set(a.point,c.point);for(let l=0,m=this.vertices.length;l<m;l++){const f=t[l];if(f!==a&&f!==c){ct.closestPointToPoint(f.point,!0,dt);const w=dt.distanceToSquared(f.point);w>i&&(i=w,d=f)}}i=-1,G.setFromCoplanarPoints(a.point,c.point,d.point);for(let l=0,m=this.vertices.length;l<m;l++){const f=t[l];if(f!==a&&f!==c&&f!==d){const w=Math.abs(G.distanceToPoint(f.point));w>i&&(i=w,u=f)}}const g=[];if(G.distanceToPoint(u.point)<0){g.push(P.create(a,c,d),P.create(u,c,a),P.create(u,d,c),P.create(u,a,d));for(let l=0;l<3;l++){const m=(l+1)%3;g[l+1].getEdge(2).setTwin(g[0].getEdge(m)),g[l+1].getEdge(1).setTwin(g[m+1].getEdge(0))}}else{g.push(P.create(a,d,c),P.create(u,a,c),P.create(u,c,d),P.create(u,d,a));for(let l=0;l<3;l++){const m=(l+1)%3;g[l+1].getEdge(2).setTwin(g[0].getEdge((3-l)%3)),g[l+1].getEdge(0).setTwin(g[m+1].getEdge(1))}}for(let l=0;l<4;l++)this.faces.push(g[l]);for(let l=0,m=t.length;l<m;l++){const f=t[l];if(f!==a&&f!==c&&f!==d&&f!==u){i=this.tolerance;let w=null;for(let E=0;E<4;E++){const L=this.faces[E].distanceToPoint(f.point);L>i&&(i=L,w=this.faces[E])}w!==null&&this._addVertexToFace(f,w)}}return this}_reindexFaces(){const t=[];for(let e=0;e<this.faces.length;e++){const o=this.faces[e];o.mark===$&&t.push(o)}return this.faces=t,this}_nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let t,e=0;const o=this.assigned.first().face;let s=o.outside;do{const i=o.distanceToPoint(s.point);i>e&&(e=i,t=s),s=s.next}while(s!==null&&s.face===o);return t}}_computeHorizon(t,e,o,s){this._deleteFaceVertices(o),o.mark=$t;let i;e===null?i=e=o.getEdge(0):i=e.next;do{const r=i.twin,a=r.face;a.mark===$&&(a.distanceToPoint(t)>this.tolerance?this._computeHorizon(t,r,a,s):s.push(i)),i=i.next}while(i!==e);return this}_addAdjoiningFace(t,e){const o=P.create(t,e.tail(),e.head());return this.faces.push(o),o.getEdge(-1).setTwin(e.twin),o.getEdge(0)}_addNewFaces(t,e){this.newFaces=[];let o=null,s=null;for(let i=0;i<e.length;i++){const r=e[i],a=this._addAdjoiningFace(t,r);o===null?o=a:a.next.setTwin(s),this.newFaces.push(a.face),s=a}return o.next.setTwin(s),this}_addVertexToHull(t){const e=[];return this.unassigned.clear(),this._removeVertexFromFace(t,t.face),this._computeHorizon(t.point,null,t.face,e),this._addNewFaces(t,e),this._resolveUnassignedPoints(this.newFaces),this}_cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}_compute(){let t;for(this._computeInitialHull();(t=this._nextVertexToAdd())!==void 0;)this._addVertexToHull(t);return this._reindexFaces(),this._cleanup(),this}}class P{constructor(){this.normal=new M,this.midpoint=new M,this.area=0,this.constant=0,this.outside=null,this.mark=$,this.edge=null}static create(t,e,o){const s=new P,i=new Q(t,s),r=new Q(e,s),a=new Q(o,s);return i.next=a.prev=r,r.next=i.prev=a,a.next=r.prev=i,s.edge=i,s.compute()}getEdge(t){let e=this.edge;for(;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){const t=this.edge.tail(),e=this.edge.head(),o=this.edge.next.head();return q.set(t.point,e.point,o.point),q.getNormal(this.normal),q.getMidpoint(this.midpoint),this.area=q.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class Q{constructor(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class Gt{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class ht{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,e){return e.prev=t.prev,e.next=t,e.prev===null?this.head=e:e.prev.next=e,t.prev=e,this}insertAfter(t,e){return e.prev=t,e.next=t.next,e.next===null?this.tail=e:e.next.prev=e,t.next=e,this}append(t){return this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){for(this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail;t.next!==null;)t=t.next;return this.tail=t,this}remove(t){return t.prev===null?this.head=t.next:t.prev.next=t.next,t.next===null?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,e){return t.prev===null?this.head=e.next:t.prev.next=e.next,e.next===null?this.tail=t.prev:e.next.prev=t.prev,this}isEmpty(){return this.head===null}}class Qt extends ft{constructor(t=[]){super();const e=[],o=[],s=new Dt().setFromPoints(t).faces;for(let i=0;i<s.length;i++){const r=s[i];let a=r.edge;do{const c=a.head().point;e.push(c.x,c.y,c.z),o.push(r.normal.x,r.normal.y,r.normal.z),a=a.next}while(a!==r.edge)}this.setAttribute("position",new lt(e,3)),this.setAttribute("normal",new lt(o,3))}}const R=document.getElementById("container");if(!R)throw new Error("container element not found");const I=new Tt;I.background=new _t(0);const C=new Lt({antialias:!0,preserveDrawingBuffer:!0});C.setPixelRatio(window.devicePixelRatio||1);C.setSize(window.innerWidth,window.innerHeight);R.appendChild(C.domElement);C.domElement.style.pointerEvents="none";const Jt=new bt(16777215,.45);I.add(Jt);const mt=new Mt(16777215,.6);mt.position.set(5,10,7);I.add(mt);const S=document.getElementById("ui");let v=!1,X=0,j=0;function Kt(n){X=n.clientX,j=n.clientY,v=z()}function z(){if(!S||S.classList.contains("hidden"))return!1;const n=S.getBoundingClientRect();return X>=n.left&&X<=n.right&&j>=n.top&&j<=n.bottom}function T(){C.domElement.style.pointerEvents=v?"none":"auto"}document.addEventListener("mousemove",n=>{Kt(n),T()},{passive:!0});document.addEventListener("mouseleave",()=>{v=!1,T()});window.addEventListener("resize",()=>{v=z(),T()},{passive:!0});var ut;(ut=document.getElementById("toggleUI"))==null||ut.addEventListener("click",()=>{setTimeout(()=>{v=z(),T()},100)});S&&(S.addEventListener("mouseenter",()=>{v=!0,T()}),S.addEventListener("mouseleave",()=>{v=!1,T()}),S.addEventListener("touchstart",()=>{v=!0,T()},{passive:!0}),S.addEventListener("pointerdown",()=>{v=!0,T()},{passive:!0}));function te(n,t,e){const o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s=Math.cos(e),i=Math.sin(e);return o[n][n]=s,o[n][t]=-i,o[t][n]=i,o[t][t]=s,o}function ee(n,t){const e=n[0]*t[0][0]+n[1]*t[1][0]+n[2]*t[2][0]+n[3]*t[3][0],o=n[0]*t[0][1]+n[1]*t[1][1]+n[2]*t[2][1]+n[3]*t[3][1],s=n[0]*t[0][2]+n[1]*t[1][2]+n[2]*t[2][2]+n[3]*t[3][2],i=n[0]*t[0][3]+n[1]*t[1][3]+n[2]*t[2][3]+n[3]*t[3][3];return[e,o,s,i]}function wt([n,t,e,o],s=3,i="perspective"){if(i==="parallel")return new M(n,t,e);const r=s-o,a=Math.abs(r)<1e-9?s:s/r;return new M(n*a,t*a,e*a)}function ot(n){const t=Math.hypot(n[0],n[1],n[2],n[3]);return t===0?n.slice():n.map(e=>e/t)}function ne(){const n=Math.sqrt(5)/5;return[[n,n,n,-3*n],[n,-n,-n,n],[-n,n,-n,n],[-n,-n,n,n],[n,n,-n,n]].map(ot)}function oe(){const n=[],t=[-1,1];for(const e of t)for(const o of t)for(const s of t)for(const i of t)n.push([e,o,s,i]);return n}function se(){const n=[];for(let t=0;t<4;t++)for(const e of[-1,1]){const o=[0,0,0,0];o[t]=e,n.push(o)}return n}function ie(){const n=[];for(let e=0;e<4;e++)for(const o of[-1,1]){const s=[0,0,0,0];s[e]=o,n.push(s)}const t=1/Math.sqrt(2);for(let e=0;e<4;e++)for(let o=e+1;o<4;o++)for(const s of[-1,1])for(const i of[-1,1]){const r=[0,0,0,0];r[e]=s*t,r[o]=i*t,n.push(r)}return n}function vt(n){const t=[];function e(o,s,i){if(s===i)t.push(o.slice());else for(let r=s;r<=i;r++)[o[s],o[r]]=[o[r],o[s]],e(o,s+1,i),[o[s],o[r]]=[o[r],o[s]]}return e(n.slice(),0,n.length-1),t}function pt(n){const t=vt(n),e=[];for(const o of t){let s=0;for(let i=0;i<o.length;i++)for(let r=i+1;r<o.length;r++)n.indexOf(o[i])>n.indexOf(o[r])&&s++;s%2===0&&e.push(o)}return e}function re(){const n=[],t=(1+Math.sqrt(5))/2,e=1/t,o=[[0,1,t,e],[0,1,-t,e],[0,1,t,-e],[0,1,-t,-e]];for(const s of o){const i=pt(s);for(const r of i)for(let a=0;a<16;a++){const c=r.map((d,u)=>a&1<<u?-d:d);n.push(c)}}for(const s of[-1,1])for(const i of[-1,1])for(const r of[-1,1])for(const a of[-1,1])n.push([s,i,r,a]);for(let s=0;s<6;s++){const i=s<3?[t,t,e,e]:[t,e,t,e],r=pt(i);for(const a of r)for(let c=0;c<16;c++){const d=a.map((u,g)=>c&1<<g?-u:u);n.push(d)}}return n.map(ot)}function ae(){const n=[],t=(1+Math.sqrt(5))/2,e=1/t,o=[-.5,.5];for(const i of o)for(const r of o)for(const a of o)for(const c of o)n.push([i,r,a,c]);for(let i=0;i<4;i++)for(const r of[-1,1]){const a=[0,0,0,0];a[i]=r,n.push(a)}const s=vt([0,1,t,e]);for(const i of s)for(let r=0;r<16;r++){if(r===0||r===15)continue;const a=i.map((c,d)=>r&1<<d?-c:c);n.push(a)}return n.map(ot)}function le(n){const t=n.length,e=[];if(t<2)return e;const o=[];for(let u=0;u<t;u++)for(let g=u+1;g<t;g++){let l=0;for(let m=0;m<4;m++){const f=n[u][m]-n[g][m];l+=f*f}l>1e-14&&o.push(l)}if(o.length===0)return e;o.sort((u,g)=>u-g);let s=0,i=0;const r=Math.max(3,Math.floor(o.length*.35));for(let u=0;u<r-1;u++){const g=o[u],l=(o[u+1]-g)/(g||1e-12);l>i&&(i=l,s=u)}const a=(o[s]+o[s+1])/2,c=a*.5,d=a*1.5;for(let u=0;u<t;u++)for(let g=u+1;g<t;g++){let l=0;for(let m=0;m<4;m++){const f=n[u][m]-n[g][m];l+=f*f}l>=c&&l<=d&&e.push([u,g])}if(e.length===0){const u=Math.min(4,t-1),g=new Set;for(let l=0;l<t;l++){const m=[];for(let f=0;f<t;f++)if(l!==f){let w=0;for(let E=0;E<4;E++){const L=n[l][E]-n[f][E];w+=L*L}m.push({j:f,d2:w})}m.sort((f,w)=>f.d2-w.d2);for(let f=0;f<u;f++){const w=l,E=m[f].j,L=w<E?`${w},${E}`:`${E},${w}`;g.has(L)||(g.add(L),e.push([w,E]))}}}return e}const Z=new nt,Y=new nt,tt=new nt;I.add(Z,Y,tt);let F=null,et=0,J=null,W=null,y=null,B=null;const h={rotationXY:0,rotationXZ:0,rotationYZ:0,rotationXW:0,rotationYW:0,rotationZW:0,showVertices:!0,vertexColor:"#ffcc00",vertexSize:.05,vertexOpacity:1,showEdges:!0,edgeColor:"#44aaff",edgeOpacity:.9,showFaces:!1,faceColor:"#aa44ff",faceOpacity:.3,projectionType:"perspective"};let b=[],A=[];function ce(n){F&&et>=n||(F&&(F.geometry.dispose(),W.dispose(),Z.remove(F),F=null,J=null,W=null),J=new It(1,10,10),W=new Rt({color:h.vertexColor,flatShading:!1}),F=new Ut(J,W,n),F.instanceMatrix.setUsage(Ht),F.castShadow=!1,F.receiveShadow=!1,Z.add(F),et=n)}function de(n){const t=Math.max(0,n*2);if(y&&B&&B.length>=t*3)return;y&&(y.geometry.dispose(),Y.remove(y),y=null,B=null),B=new Float32Array(t*3||3);const e=new ft;e.setAttribute("position",new Bt(B,3));const o=new Xt({color:h.edgeColor,transparent:h.edgeOpacity<1,opacity:h.edgeOpacity});y=new jt(e,o),y.frustumCulled=!1,Y.add(y)}function x(){K(tt);let n=b.map(e=>e.slice());const t=[[0,1,h.rotationXY],[0,2,h.rotationXZ],[1,2,h.rotationYZ],[0,3,h.rotationXW],[1,3,h.rotationYW],[2,3,h.rotationZW]];for(const[e,o,s]of t)if(Math.abs(s)>1e-12){const i=te(e,o,s);n=n.map(r=>ee(r,i))}if(A=n.map(e=>wt(e,3,h.projectionType)),K(Z),h.showVertices&&A.length>0){ce(A.length),W.color.set(h.vertexColor),W.opacity=h.vertexOpacity,W.transparent=h.vertexOpacity<1;const e=new zt,o=Math.max(1e-4,h.vertexSize);for(let s=0;s<A.length;s++){const i=A[s];e.compose(i,new At,new M(o,o,o)),F.setMatrixAt(s,e)}F.count=A.length,F.instanceMatrix.needsUpdate=!0,Z.add(F)}else F&&(F.count=0);if(K(Y),h.showEdges&&b.length>=2){const e=le(b);de(e.length);const o=y.geometry.attributes.position.array;let s=0;for(let i=0;i<e.length;i++){const[r,a]=e[i],c=A[r],d=A[a];!c||!d||(o[s++]=c.x,o[s++]=c.y,o[s++]=c.z,o[s++]=d.x,o[s++]=d.y,o[s++]=d.z)}for(;s<o.length;s++)o[s]=0;y.geometry.attributes.position.needsUpdate=!0,y.material.color.set(h.edgeColor),y.material.opacity=h.edgeOpacity,y.material.transparent=h.edgeOpacity<1,Y.add(y)}if(h.showFaces&&A.length>=4)try{const e=new Qt(A),o=new Zt({color:h.faceColor,transparent:h.faceOpacity<1,opacity:h.faceOpacity,side:Yt,depthWrite:!1}),s=new qt(e,o);s.renderOrder=2,tt.add(s)}catch(e){console.warn("ConvexGeometry failed to build hull:",e)}}function K(n){for(;n.children.length;){const t=n.children[0];n.remove(t),t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(e=>e.dispose()):t.material.dispose())}}let k,O,V,_;function xt(){const n=window.innerWidth/window.innerHeight;k=new St(60,n,.01,1e3),k.position.set(3,3,3),k.lookAt(0,0,0);const t=4;O=new Wt(-t*n/2,t*n/2,t/2,-t/2,-1e3,1e3),O.position.copy(k.position),O.lookAt(0,0,0),V=k,_&&_.dispose(),_=new gt(V,R),_.enableDamping=!0,_.enabled=!0,v=z(),T()}xt();window.addEventListener("resize",()=>{const n=window.innerWidth/window.innerHeight;k.aspect=n,k.updateProjectionMatrix();const t=4;O.left=-t*n/2,O.right=t*n/2,O.top=t/2,O.bottom=-t/2,O.updateProjectionMatrix(),C.setSize(window.innerWidth,window.innerHeight),v=z(),T()});function he(){const n=p=>document.getElementById(p),t=n("showVerts"),e=n("vertColor"),o=n("vertSize"),s=n("showEdges"),i=n("edgeColor"),r=n("edgeOpacity"),a=n("showFaces"),c=n("faceColor"),d=n("faceOpacity"),u=n("rotXY"),g=n("rotXZ"),l=n("rotYZ"),m=n("rotXW"),f=n("rotYW"),w=n("rotZW"),E=n("projectionType"),L=n("toggleUI"),D=n("ui"),it=n("fullscreenBtn"),rt=n("renderBtn"),Et=n("resMult"),U=n("progress"),at=n("polytopeSelect");t&&t.addEventListener("change",p=>{h.showVertices=p.target.checked,x()}),e&&e.addEventListener("input",p=>{h.vertexColor=p.target.value,W&&W.color.set(p.target.value),x()}),o&&o.addEventListener("input",p=>{h.vertexSize=parseFloat(p.target.value),x()}),s&&s.addEventListener("change",p=>{h.showEdges=p.target.checked,x()}),i&&i.addEventListener("input",p=>{h.edgeColor=p.target.value,y&&y.material.color.set(p.target.value),x()}),r&&r.addEventListener("input",p=>{h.edgeOpacity=parseFloat(p.target.value),y&&(y.material.opacity=h.edgeOpacity,y.material.transparent=h.edgeOpacity<1),x()}),a&&a.addEventListener("change",p=>{h.showFaces=p.target.checked,x()}),c&&c.addEventListener("input",p=>{h.faceColor=p.target.value,x()}),d&&d.addEventListener("input",p=>{h.faceOpacity=parseFloat(p.target.value),x()}),u&&u.addEventListener("input",p=>{h.rotationXY=parseFloat(p.target.value),x()}),g&&g.addEventListener("input",p=>{h.rotationXZ=parseFloat(p.target.value),x()}),l&&l.addEventListener("input",p=>{h.rotationYZ=parseFloat(p.target.value),x()}),m&&m.addEventListener("input",p=>{h.rotationXW=parseFloat(p.target.value),x()}),f&&f.addEventListener("input",p=>{h.rotationYW=parseFloat(p.target.value),x()}),w&&w.addEventListener("input",p=>{h.rotationZW=parseFloat(p.target.value),x()}),E&&E.addEventListener("change",p=>{h.projectionType=p.target.value,V=h.projectionType==="parallel"?O:k,_&&_.dispose(),_=new gt(V,R),_.enableDamping=!0,N(),x()}),L&&D&&L.addEventListener("click",()=>{D.classList.toggle("hidden"),L.textContent=D.classList.contains("hidden")?"Show UI":"Hide UI",setTimeout(()=>{v=z(),T()},100)}),it&&R&&it.addEventListener("click",async()=>{try{document.fullscreenElement?(await document.exitFullscreen(),setTimeout(()=>{window.dispatchEvent(new Event("resize")),v=z(),T()},300)):(await R.requestFullscreen(),setTimeout(()=>{window.dispatchEvent(new Event("resize")),v=z(),T()},300))}catch(p){alert("Fullscreen failed: "+p.message)}}),rt&&rt.addEventListener("click",async()=>{U.textContent="Rendering...";try{const p=Math.max(1,parseInt(Et.value||"1",10)),Ft=C.getPixelRatio();C.setPixelRatio((window.devicePixelRatio||1)*p),C.setSize(Math.round(window.innerWidth),Math.round(window.innerHeight),!1),await new Promise(requestAnimationFrame),C.render(I,V),await new Promise(requestAnimationFrame);const Ct=C.domElement.toDataURL("image/png");C.setPixelRatio(Ft),C.setSize(window.innerWidth,window.innerHeight,!1);const H=document.createElement("a");H.href=Ct,H.download=`4d_polytope_${Date.now()}.png`,document.body.appendChild(H),H.click(),document.body.removeChild(H),U.textContent="Saved!",setTimeout(()=>U.textContent="",1500)}catch(p){console.error(p),U.textContent="Render failed",setTimeout(()=>U.textContent="",2e3)}}),at&&at.addEventListener("change",p=>{st(p.target.value),N(),x()})}function st(n){switch(n){case"4-simplex":b=ne();break;case"hypercube":b=oe();break;case"16-cell":b=se();break;case"24-cell":b=ie();break;case"120-cell":b=re();break;case"600-cell":b=ae();break;default:b=[]}et=0}function N(){if(!b.length)return;const n=b.map(i=>wt(i,3,h.projectionType)),t=new Vt().setFromPoints(n),e=t.getCenter(new M),o=t.getSize(new M).length(),s=Math.max(2,o*1.6);k.position.set(e.x+s,e.y+s,e.z+s),k.lookAt(e),O.position.copy(k.position),O.lookAt(e),_&&(_.target.copy(e),_.update())}st("24-cell");he();xt();N();x();v=z();T();function yt(){requestAnimationFrame(yt),X!==void 0&&j!==void 0&&(v=z(),T()),_&&_.update(),C.render(I,V)}yt();window.__poly={loadPolytope:st,updateGeometry:x,boundsToCamera:N,scene:I,renderer:C,camera:()=>V,__isOverUI:()=>v,__checkUI:()=>(v=z(),T(),v),__debug:()=>{console.log({isOverUI:v,mousePos:[X,j],uiRect:S?S.getBoundingClientRect():null,canvasPointerEvents:C.domElement.style.pointerEvents})}};
//# sourceMappingURL=polytopes.js.map
