import"./modulepreload-polyfill.js";import{V as _,e as Fe,f as be,g as Le,B as pe,F as ce,S as Pe,h as _e,W as Te,A as ke,D as Se,G as ne,i as Ve,Q as Oe,P as Ae,j as je,k as ze,l as Ie,m as We,I as Be,n as He,a as Re,L as Ue,b as De,o as Xe,p as Ye,c as Ze}from"./three.module.js";import{O as me}from"./OrbitControls.js";const G=0,Ge=1,qe=new _,le=new Fe,$=new be,de=new _,Z=new Le;class Ne{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new ue,this.unassigned=new ue,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.vertices.push(new $e(e[t]));this._compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(s){const i=s.geometry;if(i!==void 0){const o=i.attributes.position;if(o!==void 0)for(let r=0,a=o.count;r<a;r++){const l=new _;l.fromBufferAttribute(o,r).applyMatrix4(s.matrixWorld),t.push(l)}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let s=0,i=t.length;s<i;s++)if(t[s].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const s=this.faces;let i=-1/0,o=1/0;for(let r=0,a=s.length;r<a;r++){const l=s[r],d=l.distanceToPoint(e.origin),u=l.normal.dot(e.direction);if(d>0&&u>=0)return null;const m=u!==0?-d/u:0;if(!(m<=0)&&(u>0?o=Math.min(m,o):i=Math.max(m,i),i>o))return null}return i!==-1/0?e.at(i,t):e.at(o,t),t}intersectsRay(e){return this.intersectRay(e,qe)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}_addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}_removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}_removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let s=e.outside;for(;s.next!==null&&s.next.face===e;)s=s.next;return this.assigned.removeSubList(t,s),t.prev=s.next=null,e.outside=null,t}}_deleteFaceVertices(e,t){const s=this._removeAllVerticesFromFace(e);if(s!==void 0)if(t===void 0)this.unassigned.appendChain(s);else{let i=s;do{const o=i.next;t.distanceToPoint(i.point)>this.tolerance?this._addVertexToFace(i,t):this.unassigned.append(i),i=o}while(i!==null)}return this}_resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const s=t.next;let i=this.tolerance,o=null;for(let r=0;r<e.length;r++){const a=e[r];if(a.mark===G){const l=a.distanceToPoint(t.point);if(l>i&&(i=l,o=a),i>1e3*this.tolerance)break}}o!==null&&this._addVertexToFace(t,o),t=s}while(t!==null)}return this}_computeExtremes(){const e=new _,t=new _,s=[],i=[];for(let o=0;o<3;o++)s[o]=i[o]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let o=0,r=this.vertices.length;o<r;o++){const a=this.vertices[o],l=a.point;for(let d=0;d<3;d++)l.getComponent(d)<e.getComponent(d)&&(e.setComponent(d,l.getComponent(d)),s[d]=a);for(let d=0;d<3;d++)l.getComponent(d)>t.getComponent(d)&&(t.setComponent(d,l.getComponent(d)),i[d]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:s,max:i}}_computeInitialHull(){const e=this.vertices,t=this._computeExtremes(),s=t.min,i=t.max;let o=0,r=0;for(let c=0;c<3;c++){const g=i[c].point.getComponent(c)-s[c].point.getComponent(c);g>o&&(o=g,r=c)}const a=s[r],l=i[r];let d,u;o=0,le.set(a.point,l.point);for(let c=0,g=this.vertices.length;c<g;c++){const p=e[c];if(p!==a&&p!==l){le.closestPointToPoint(p.point,!0,de);const w=de.distanceToSquared(p.point);w>o&&(o=w,d=p)}}o=-1,$.setFromCoplanarPoints(a.point,l.point,d.point);for(let c=0,g=this.vertices.length;c<g;c++){const p=e[c];if(p!==a&&p!==l&&p!==d){const w=Math.abs($.distanceToPoint(p.point));w>o&&(o=w,u=p)}}const m=[];if($.distanceToPoint(u.point)<0){m.push(T.create(a,l,d),T.create(u,l,a),T.create(u,d,l),T.create(u,a,d));for(let c=0;c<3;c++){const g=(c+1)%3;m[c+1].getEdge(2).setTwin(m[0].getEdge(g)),m[c+1].getEdge(1).setTwin(m[g+1].getEdge(0))}}else{m.push(T.create(a,d,l),T.create(u,a,l),T.create(u,l,d),T.create(u,d,a));for(let c=0;c<3;c++){const g=(c+1)%3;m[c+1].getEdge(2).setTwin(m[0].getEdge((3-c)%3)),m[c+1].getEdge(0).setTwin(m[g+1].getEdge(1))}}for(let c=0;c<4;c++)this.faces.push(m[c]);for(let c=0,g=e.length;c<g;c++){const p=e[c];if(p!==a&&p!==l&&p!==d&&p!==u){o=this.tolerance;let w=null;for(let E=0;E<4;E++){const L=this.faces[E].distanceToPoint(p.point);L>o&&(o=L,w=this.faces[E])}w!==null&&this._addVertexToFace(p,w)}}return this}_reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const s=this.faces[t];s.mark===G&&e.push(s)}return this.faces=e,this}_nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const s=this.assigned.first().face;let i=s.outside;do{const o=s.distanceToPoint(i.point);o>t&&(t=o,e=i),i=i.next}while(i!==null&&i.face===s);return e}}_computeHorizon(e,t,s,i){this._deleteFaceVertices(s),s.mark=Ge;let o;t===null?o=t=s.getEdge(0):o=t.next;do{const r=o.twin,a=r.face;a.mark===G&&(a.distanceToPoint(e)>this.tolerance?this._computeHorizon(e,r,a,i):i.push(o)),o=o.next}while(o!==t);return this}_addAdjoiningFace(e,t){const s=T.create(e,t.tail(),t.head());return this.faces.push(s),s.getEdge(-1).setTwin(t.twin),s.getEdge(0)}_addNewFaces(e,t){this.newFaces=[];let s=null,i=null;for(let o=0;o<t.length;o++){const r=t[o],a=this._addAdjoiningFace(e,r);s===null?s=a:a.next.setTwin(i),this.newFaces.push(a.face),i=a}return s.next.setTwin(i),this}_addVertexToHull(e){const t=[];return this.unassigned.clear(),this._removeVertexFromFace(e,e.face),this._computeHorizon(e.point,null,e.face,t),this._addNewFaces(e,t),this._resolveUnassignedPoints(this.newFaces),this}_cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}_compute(){let e;for(this._computeInitialHull();(e=this._nextVertexToAdd())!==void 0;)this._addVertexToHull(e);return this._reindexFaces(),this._cleanup(),this}}class T{constructor(){this.normal=new _,this.midpoint=new _,this.area=0,this.constant=0,this.outside=null,this.mark=G,this.edge=null}static create(e,t,s){const i=new T,o=new Q(e,i),r=new Q(t,i),a=new Q(s,i);return o.next=a.prev=r,r.next=o.prev=a,a.next=r.prev=o,i.edge=o,i.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),s=this.edge.next.head();return Z.set(e.point,t.point,s.point),Z.getNormal(this.normal),Z.getMidpoint(this.midpoint),this.area=Z.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class Q{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class $e{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class ue{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}}class Qe extends pe{constructor(e=[]){super();const t=[],s=[],o=new Ne().setFromPoints(e).faces;for(let r=0;r<o.length;r++){const a=o[r];let l=a.edge;do{const d=l.head().point;t.push(d.x,d.y,d.z),s.push(a.normal.x,a.normal.y,a.normal.z),l=l.next}while(l!==a.edge)}this.setAttribute("position",new ce(t,3)),this.setAttribute("normal",new ce(s,3))}}const W=document.getElementById("container");if(!W)throw new Error("container element not found");const I=new Pe;I.background=new _e(0);const M=new Te({antialias:!0,preserveDrawingBuffer:!0});M.setPixelRatio(window.devicePixelRatio||1);M.setSize(window.innerWidth,window.innerHeight);W.appendChild(M.domElement);M.domElement.style.pointerEvents="none";const Je=new ke(16777215,.45);I.add(Je);const ge=new Se(16777215,.6);ge.position.set(5,10,7);I.add(ge);const A=document.getElementById("ui");let v=!1,U=0,D=0;function Ke(n){U=n.clientX,D=n.clientY,v=V()}function V(){if(!A||A.classList.contains("hidden"))return!1;const n=A.getBoundingClientRect();return U>=n.left&&U<=n.right&&D>=n.top&&D<=n.bottom}function F(){M.domElement.style.pointerEvents=v?"none":"auto"}document.addEventListener("mousemove",n=>{Ke(n),F()},{passive:!0});document.addEventListener("mouseleave",()=>{v=!1,F()});window.addEventListener("resize",()=>{v=V(),F()},{passive:!0});var fe;(fe=document.getElementById("toggleUI"))==null||fe.addEventListener("click",()=>{setTimeout(()=>{v=V(),F()},100)});A&&(A.addEventListener("mouseenter",()=>{v=!0,F()}),A.addEventListener("mouseleave",()=>{v=!1,F()}),A.addEventListener("touchstart",()=>{v=!0,F()},{passive:!0}),A.addEventListener("pointerdown",()=>{v=!0,F()},{passive:!0}));function et(n,e,t){const s=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],i=Math.cos(t),o=Math.sin(t);return s[n][n]=i,s[n][e]=-o,s[e][n]=o,s[e][e]=i,s}function tt(n,e){const t=n[0]*e[0][0]+n[1]*e[1][0]+n[2]*e[2][0]+n[3]*e[3][0],s=n[0]*e[0][1]+n[1]*e[1][1]+n[2]*e[2][1]+n[3]*e[3][1],i=n[0]*e[0][2]+n[1]*e[1][2]+n[2]*e[2][2]+n[3]*e[3][2],o=n[0]*e[0][3]+n[1]*e[1][3]+n[2]*e[2][3]+n[3]*e[3][3];return[t,s,i,o]}function we([n,e,t,s],i=3,o="perspective"){if(o==="parallel")return new _(n,e,t);const r=i-s,a=Math.abs(r)<1e-9?i:i/r;return new _(n*a,e*a,t*a)}function se(n){const e=Math.hypot(n[0],n[1],n[2],n[3]);return e===0?n.slice():n.map(t=>t/e)}function nt(){const n=Math.sqrt(5)/5;return[[n,n,n,-3*n],[n,-n,-n,n],[-n,n,-n,n],[-n,-n,n,n],[n,n,-n,n]].map(se)}function st(){const n=[],e=[-1,1];for(const t of e)for(const s of e)for(const i of e)for(const o of e)n.push([t,s,i,o]);return n}function it(){const n=[];for(let e=0;e<4;e++)for(const t of[-1,1]){const s=[0,0,0,0];s[e]=t,n.push(s)}return n}function ot(){const n=[];for(let t=0;t<4;t++)for(const s of[-1,1]){const i=[0,0,0,0];i[t]=s,n.push(i)}const e=1/Math.sqrt(2);for(let t=0;t<4;t++)for(let s=t+1;s<4;s++)for(const i of[-1,1])for(const o of[-1,1]){const r=[0,0,0,0];r[t]=i*e,r[s]=o*e,n.push(r)}return n}function ve(n){const e=[];function t(s,i,o){if(i===o)e.push(s.slice());else for(let r=i;r<=o;r++)[s[i],s[r]]=[s[r],s[i]],t(s,i+1,o),[s[i],s[r]]=[s[r],s[i]]}return t(n.slice(),0,n.length-1),e}function he(n){const e=ve(n),t=[];for(const s of e){let i=0;for(let o=0;o<s.length;o++)for(let r=o+1;r<s.length;r++)n.indexOf(s[o])>n.indexOf(s[r])&&i++;i%2===0&&t.push(s)}return t}function rt(){const n=[],e=(1+Math.sqrt(5))/2,t=1/e,s=[[0,1,e,t],[0,1,-e,t],[0,1,e,-t],[0,1,-e,-t]];for(const i of s){const o=he(i);for(const r of o)for(let a=0;a<16;a++){const l=r.map((d,u)=>a&1<<u?-d:d);n.push(l)}}for(const i of[-1,1])for(const o of[-1,1])for(const r of[-1,1])for(const a of[-1,1])n.push([i,o,r,a]);for(let i=0;i<6;i++){const o=i<3?[e,e,t,t]:[e,t,e,t],r=he(o);for(const a of r)for(let l=0;l<16;l++){const d=a.map((u,m)=>l&1<<m?-u:u);n.push(d)}}return n.map(se)}function at(){const n=[],e=(1+Math.sqrt(5))/2,t=1/e,s=[-.5,.5];for(const r of s)for(const a of s)for(const l of s)for(const d of s)n.push([r,a,l,d]);for(let r=0;r<4;r++)for(const a of[-1,1]){const l=[0,0,0,0];l[r]=a,n.push(l)}const o=ve([0,1,e,t]);for(const r of o)for(let a=0;a<16;a++){if(a===0||a===15)continue;const l=r.map((d,u)=>a&1<<u?-d:d);n.push(l)}return n.map(se)}function ct(n){const e=n.length,t=[];if(e<2)return t;const s=[];for(let u=0;u<e;u++)for(let m=u+1;m<e;m++){let c=0;for(let g=0;g<4;g++){const p=n[u][g]-n[m][g];c+=p*p}c>1e-14&&s.push(c)}if(s.length===0)return t;s.sort((u,m)=>u-m);let i=0,o=0;const r=Math.max(3,Math.floor(s.length*.35));for(let u=0;u<r-1;u++){const m=s[u],g=(s[u+1]-m)/(m||1e-12);g>o&&(o=g,i=u)}const a=(s[i]+s[i+1])/2,l=a*.5,d=a*1.5;for(let u=0;u<e;u++)for(let m=u+1;m<e;m++){let c=0;for(let g=0;g<4;g++){const p=n[u][g]-n[m][g];c+=p*p}c>=l&&c<=d&&t.push([u,m])}if(t.length===0){const u=Math.min(4,e-1),m=new Set;for(let c=0;c<e;c++){const g=[];for(let p=0;p<e;p++)if(c!==p){let w=0;for(let E=0;E<4;E++){const L=n[c][E]-n[p][E];w+=L*L}g.push({j:p,d2:w})}g.sort((p,w)=>p.d2-w.d2);for(let p=0;p<u;p++){const w=c,E=g[p].j,L=w<E?`${w},${E}`:`${E},${w}`;m.has(L)||(m.add(L),t.push([w,E]))}}}return t}const X=new ne,Y=new ne,ee=new ne;I.add(X,Y,ee);let C=null,te=0,J=null,j=null,y=null,R=null;const h={rotationXY:0,rotationXZ:0,rotationYZ:0,rotationXW:0,rotationYW:0,rotationZW:0,showVertices:!0,vertexColor:"#ffcc00",vertexSize:.05,vertexOpacity:1,showEdges:!0,edgeColor:"#44aaff",edgeOpacity:.9,showFaces:!1,faceColor:"#aa44ff",faceOpacity:.3,projectionType:"perspective"};let P=[],O=[];function lt(n){C&&te>=n||(C&&(C.geometry.dispose(),j.dispose(),X.remove(C),C=null,J=null,j=null),J=new Ie(1,10,10),j=new We({color:h.vertexColor,flatShading:!1}),C=new Be(J,j,n),C.instanceMatrix.setUsage(He),C.castShadow=!1,C.receiveShadow=!1,X.add(C),te=n)}function dt(n){const e=Math.max(0,n*2);if(y&&R&&R.length>=e*3)return;y&&(y.geometry.dispose(),Y.remove(y),y=null,R=null),R=new Float32Array(e*3||3);const s=new pe;s.setAttribute("position",new Re(R,3));const i=new Ue({color:h.edgeColor,transparent:h.edgeOpacity<1,opacity:h.edgeOpacity});y=new De(s,i),y.frustumCulled=!1,Y.add(y)}function x(){K(ee);let n=P.map(t=>t.slice());const e=[[0,1,h.rotationXY],[0,2,h.rotationXZ],[1,2,h.rotationYZ],[0,3,h.rotationXW],[1,3,h.rotationYW],[2,3,h.rotationZW]];for(const[t,s,i]of e)if(Math.abs(i)>1e-12){const o=et(t,s,i);n=n.map(r=>tt(r,o))}if(O=n.map(t=>we(t,3,h.projectionType)),K(X),h.showVertices&&O.length>0){lt(O.length),j.color.set(h.vertexColor),j.opacity=h.vertexOpacity,j.transparent=h.vertexOpacity<1;const t=new Ve,s=Math.max(1e-4,h.vertexSize);for(let i=0;i<O.length;i++){const o=O[i];t.compose(o,new Oe,new _(s,s,s)),C.setMatrixAt(i,t)}C.count=O.length,C.instanceMatrix.needsUpdate=!0,X.add(C)}else C&&(C.count=0);if(K(Y),h.showEdges&&P.length>=2){const t=ct(P);dt(t.length);const s=y.geometry.attributes.position.array;let i=0;for(let o=0;o<t.length;o++){const[r,a]=t[o],l=O[r],d=O[a];!l||!d||(s[i++]=l.x,s[i++]=l.y,s[i++]=l.z,s[i++]=d.x,s[i++]=d.y,s[i++]=d.z)}for(;i<s.length;i++)s[i]=0;y.geometry.attributes.position.needsUpdate=!0,y.material.color.set(h.edgeColor),y.material.opacity=h.edgeOpacity,y.material.transparent=h.edgeOpacity<1,Y.add(y)}if(h.showFaces&&O.length>=4)try{const t=new Qe(O),s=new Xe({color:h.faceColor,transparent:h.faceOpacity<1,opacity:h.faceOpacity,side:Ye,depthWrite:!1}),i=new Ze(t,s);i.renderOrder=2,ee.add(i)}catch(t){console.warn("ConvexGeometry failed to build hull:",t)}}function K(n){for(;n.children.length;){const e=n.children[0];n.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose())}}let k,S,z,b;function xe(){const n=window.innerWidth/window.innerHeight;k=new Ae(60,n,.01,1e3),k.position.set(3,3,3),k.lookAt(0,0,0);const e=4;S=new je(-e*n/2,e*n/2,e/2,-e/2,-1e3,1e3),S.position.copy(k.position),S.lookAt(0,0,0),z=k,b&&b.dispose(),b=new me(z,W),b.enableDamping=!0,b.enabled=!0,v=V(),F()}xe();window.addEventListener("resize",()=>{const n=window.innerWidth/window.innerHeight;k.aspect=n,k.updateProjectionMatrix();const e=4;S.left=-e*n/2,S.right=e*n/2,S.top=e/2,S.bottom=-e/2,S.updateProjectionMatrix(),M.setSize(window.innerWidth,window.innerHeight),v=V(),F()});function ut(){const n=f=>document.getElementById(f),e=n("showVerts"),t=n("vertColor"),s=n("vertSize"),i=n("showEdges"),o=n("edgeColor"),r=n("edgeOpacity"),a=n("showFaces"),l=n("faceColor"),d=n("faceOpacity"),u=n("rotXY"),m=n("rotXZ"),c=n("rotYZ"),g=n("rotXW"),p=n("rotYW"),w=n("rotZW"),E=n("projectionType"),L=n("toggleUI"),N=n("ui"),oe=n("fullscreenBtn"),re=n("renderBtn"),Ee=n("resMult"),B=n("progress"),ae=n("polytopeSelect");e&&e.addEventListener("change",f=>{h.showVertices=f.target.checked,x()}),t&&t.addEventListener("input",f=>{h.vertexColor=f.target.value,j&&j.color.set(f.target.value),x()}),s&&s.addEventListener("input",f=>{h.vertexSize=parseFloat(f.target.value),x()}),i&&i.addEventListener("change",f=>{h.showEdges=f.target.checked,x()}),o&&o.addEventListener("input",f=>{h.edgeColor=f.target.value,y&&y.material.color.set(f.target.value),x()}),r&&r.addEventListener("input",f=>{h.edgeOpacity=parseFloat(f.target.value),y&&(y.material.opacity=h.edgeOpacity,y.material.transparent=h.edgeOpacity<1),x()}),a&&a.addEventListener("change",f=>{h.showFaces=f.target.checked,x()}),l&&l.addEventListener("input",f=>{h.faceColor=f.target.value,x()}),d&&d.addEventListener("input",f=>{h.faceOpacity=parseFloat(f.target.value),x()}),u&&u.addEventListener("input",f=>{h.rotationXY=parseFloat(f.target.value),x()}),m&&m.addEventListener("input",f=>{h.rotationXZ=parseFloat(f.target.value),x()}),c&&c.addEventListener("input",f=>{h.rotationYZ=parseFloat(f.target.value),x()}),g&&g.addEventListener("input",f=>{h.rotationXW=parseFloat(f.target.value),x()}),p&&p.addEventListener("input",f=>{h.rotationYW=parseFloat(f.target.value),x()}),w&&w.addEventListener("input",f=>{h.rotationZW=parseFloat(f.target.value),x()}),E&&E.addEventListener("change",f=>{h.projectionType=f.target.value,z=h.projectionType==="parallel"?S:k,b&&b.dispose(),b=new me(z,W),b.enableDamping=!0,q(),x()}),L&&N&&L.addEventListener("click",()=>{N.classList.toggle("hidden"),L.textContent=N.classList.contains("hidden")?"Show UI":"Hide UI",setTimeout(()=>{v=V(),F()},100)}),oe&&W&&oe.addEventListener("click",async()=>{try{document.fullscreenElement?(await document.exitFullscreen(),setTimeout(()=>{window.dispatchEvent(new Event("resize")),v=V(),F()},300)):(await W.requestFullscreen(),setTimeout(()=>{window.dispatchEvent(new Event("resize")),v=V(),F()},300))}catch(f){alert("Fullscreen failed: "+f.message)}}),re&&re.addEventListener("click",async()=>{B.textContent="Rendering...";try{const f=Math.max(1,parseInt(Ee.value||"1",10)),Ce=M.getPixelRatio();M.setPixelRatio((window.devicePixelRatio||1)*f),M.setSize(Math.round(window.innerWidth),Math.round(window.innerHeight),!1),await new Promise(requestAnimationFrame),M.render(I,z),await new Promise(requestAnimationFrame);const Me=M.domElement.toDataURL("image/png");M.setPixelRatio(Ce),M.setSize(window.innerWidth,window.innerHeight,!1);const H=document.createElement("a");H.href=Me,H.download=`4d_polytope_${Date.now()}.png`,document.body.appendChild(H),H.click(),document.body.removeChild(H),B.textContent="Saved!",setTimeout(()=>B.textContent="",1500)}catch(f){console.error(f),B.textContent="Render failed",setTimeout(()=>B.textContent="",2e3)}}),ae&&ae.addEventListener("change",f=>{ie(f.target.value),q(),x()})}function ie(n){switch(n){case"4-simplex":P=nt();break;case"hypercube":P=st();break;case"16-cell":P=it();break;case"24-cell":P=ot();break;case"120-cell":P=rt();break;case"600-cell":P=at();break;default:P=[]}te=0}function q(){if(!P.length)return;const n=P.map(o=>we(o,3,h.projectionType)),e=new ze().setFromPoints(n),t=e.getCenter(new _),s=e.getSize(new _).length(),i=Math.max(2,s*1.6);k.position.set(t.x+i,t.y+i,t.z+i),k.lookAt(t),S.position.copy(k.position),S.lookAt(t),b&&(b.target.copy(t),b.update())}ie("24-cell");ut();xe();q();x();v=V();F();function ye(){requestAnimationFrame(ye),U!==void 0&&D!==void 0&&(v=V(),F()),b&&b.update(),M.render(I,z)}ye();window.__poly={loadPolytope:ie,updateGeometry:x,boundsToCamera:q,scene:I,renderer:M,camera:()=>z,__isOverUI:()=>v,__checkUI:()=>(v=V(),F(),v),__debug:()=>{console.log({isOverUI:v,mousePos:[U,D],uiRect:A?A.getBoundingClientRect():null,canvasPointerEvents:M.domElement.style.pointerEvents})}};
//# sourceMappingURL=polytopes.js.map
