const o=document.getElementById("fractalCanvas"),C=o.getContext("2d"),N=document.getElementById("funcInput"),Q=document.getElementById("cReal"),U=document.getElementById("cImag"),_=document.getElementById("iterations"),$=document.getElementById("gradient"),tt=document.getElementById("resetView");let c=window.innerWidth,s=window.innerHeight;o.width=c;o.height=s;let m=0,y=0,a=4/c,u=!1,g={x:0,y:0},n={x:0,y:0},d={x:0,y:0},f=!1;const Y=document.createElement("canvas"),j=Y.getContext("2d");Y.width=c;Y.height=s;let X=!1,G=0,R=null,p=1,L={x:0,y:0},O=null;function V(t,e){const l=e.clientX-t.clientX,h=e.clientY-t.clientY;return Math.sqrt(l*l+h*h)}function Z(t,e){return{x:(t.clientX+e.clientX)/2,y:(t.clientY+e.clientY)/2}}function et(t){try{let e=t.replace(/\^/g,"**");return math.compile(e)}catch(e){return alert("Invalid formula: "+e),null}}function q(t){t=t.replace("#",""),t.length===3&&(t=t.split("").map(l=>l+l).join(""));const e=parseInt(t,16);return[e>>16&255,e>>8&255,e&255]}function nt(t,e){let l=[];for(let h=0;h<e;h++){let T=h/(e-1)*(t.length-1),v=Math.floor(T),w=Math.min(v+1,t.length-1),I=T-v,i=q(t[v]),D=q(t[w]);l.push([Math.round(i[0]+I*(D[0]-i[0])),Math.round(i[1]+I*(D[1]-i[1])),Math.round(i[2]+I*(D[2]-i[2]))])}return l}async function x(){f=!0;const t=et(N.value);if(!t){f=!1;return}const e=parseFloat(Q.value),l=parseFloat(U.value),h=parseInt(_.value),P=$.value.split(",").map(i=>i.trim()),T=nt(P,h+1),v=j.createImageData(c,s),w=v.data,I=50;for(let i=0;i<s;i+=I){const D=Math.min(i+I,s);for(let E=i;E<D;E++)for(let B=0;B<c;B++){let A=m+(B-c/2)*a,J=y+(E-s/2)*a,M=A,z=J,S=0;for(;S<h;){let K={z:math.complex(M,z),c:math.complex(e,l)},W=t.evaluate(K);if(M=W.re,z=W.im,M*M+z*z>4)break;S++}let k=T[S]||[0,0,0],F=4*(E*c+B);w[F]=k[0],w[F+1]=k[1],w[F+2]=k[2],w[F+3]=255}j.putImageData(v,0,0),await new Promise(E=>setTimeout(E,0))}f=!1,n.x=0,n.y=0}function r(t=1,e=0,l=0){C.clearRect(0,0,c,s),C.save(),C.translate(e,l),C.scale(t,t),C.drawImage(Y,0,0),C.restore()}o.addEventListener("mousedown",t=>{u=!0,g.x=t.clientX,g.y=t.clientY,d.x=m,d.y=y,f||(n.x=0,n.y=0)});o.addEventListener("mousemove",t=>{u&&(n.x=t.clientX-g.x,n.y=t.clientY-g.y,r(1,n.x,n.y))});o.addEventListener("mouseup",t=>{u&&(f||(m=d.x-n.x*a,y=d.y-n.y*a,n.x=0,n.y=0,x(),r()),u=!1)});o.addEventListener("mouseleave",()=>{u&&(f||(m=d.x-n.x*a,y=d.y-n.y*a,n.x=0,n.y=0,x(),r()),u=!1)});let b=1,H=null;o.addEventListener("wheel",t=>{t.preventDefault();const e=t.deltaY<0?.9:1.1;a/=e,b*=e,r(b),H&&clearTimeout(H),H=setTimeout(()=>{b=1,x(),r()},300)});o.addEventListener("touchstart",t=>{t.preventDefault(),t.touches.length===1?(u=!0,g.x=t.touches[0].clientX,g.y=t.touches[0].clientY,d.x=m,d.y=y,f||(n.x=0,n.y=0),X=!1):t.touches.length===2&&(u=!1,X=!0,G=V(t.touches[0],t.touches[1]),R=Z(t.touches[0],t.touches[1]),p=1,L={x:0,y:0},O=R)});o.addEventListener("touchmove",t=>{if(t.preventDefault(),t.touches.length===1&&u)n.x=t.touches[0].clientX-g.x,n.y=t.touches[0].clientY-g.y,r(1,n.x,n.y);else if(t.touches.length===2&&X){const e=V(t.touches[0],t.touches[1]),l=Z(t.touches[0],t.touches[1]);p=e/G,L.x+=l.x-O.x,L.y+=l.y-O.y,O=l,r(p,L.x,L.y)}});o.addEventListener("touchend",t=>{if(t.preventDefault(),u&&(f||(m=d.x-n.x*a,y=d.y-n.y*a,n.x=0,n.y=0,x(),r()),u=!1),X&&t.touches.length<2){const e=R.x-c/2,l=R.y-s/2;a/=p,m+=e*(a-a*p),y+=l*(a-a*p),p=1,L={x:0,y:0},X=!1,x(),r()}});tt.addEventListener("click",()=>{m=0,y=0,a=4/c,x(),r()});window.addEventListener("resize",()=>{c=window.innerWidth,s=window.innerHeight,o.width=c,o.height=s,Y.width=c,Y.height=s,a=4/c,x(),r()});window.addEventListener("DOMContentLoaded",()=>{x(),r()});
//# sourceMappingURL=fractal2.js.map
