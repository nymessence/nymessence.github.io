import"./modulepreload-polyfill.js";import"./modulepreload-polyfill2.js";const c=document.getElementById("fractalCanvas"),I=c.getContext("2d"),S=document.getElementById("funcInput"),U=document.getElementById("cReal"),Z=document.getElementById("cImag"),_=document.getElementById("iterations"),$=document.getElementById("gradient"),tt=document.getElementById("resetView");let o=window.innerWidth,r=window.innerHeight;c.width=o;c.height=r;let f=0,g=0,a=4/o,s=!1,v={x:0,y:0},n={x:0,y:0},d={x:0,y:0},x=!1;const M=document.createElement("canvas"),O=M.getContext("2d");M.width=o;M.height=r;let Y=!1,V=0,H=null,w=1,L={x:0,y:0},F=null;function A(t,e){const l=e.clientX-t.clientX,h=e.clientY-t.clientY;return Math.sqrt(l*l+h*h)}function G(t,e){return{x:(t.clientX+e.clientX)/2,y:(t.clientY+e.clientY)/2}}function et(t){try{let e=t.replace(/\^/g,"**");return math.compile(e)}catch(e){return alert("Invalid formula: "+e),null}}function P(t){t=t.replace("#",""),t.length===3&&(t=t.split("").map(l=>l+l).join(""));const e=parseInt(t,16);return[e>>16&255,e>>8&255,e&255]}function nt(t,e){let l=[];for(let h=0;h<e;h++){let B=h/(e-1)*(t.length-1),X=Math.floor(B),D=Math.min(X+1,t.length-1),y=B-X,m=P(t[X]),u=P(t[D]);l.push([Math.round(m[0]+y*(u[0]-m[0])),Math.round(m[1]+y*(u[1]-m[1])),Math.round(m[2]+y*(u[2]-m[2]))])}return l}async function p(){x=!0;const t=et(S.value);if(!t){x=!1;return}const e=parseFloat(U.value),l=parseFloat(Z.value),h=parseInt(_.value),B=$.value.split(",").map(u=>u.trim()),X=nt(B,h+1),D=O.createImageData(o,r),y=D.data,m=50;for(let u=0;u<r;u+=m){const J=Math.min(u+m,r);for(let E=u;E<J;E++)for(let C=0;C<o;C++){let K=f+(C-o/2)*a,N=g+(E-r/2)*a,T=K,k=N,R=0;for(;R<h;){let Q={z:math.complex(T,k),c:math.complex(e,l)},q=t.evaluate(Q);if(T=q.re,k=q.im,T*T+k*k>4)break;R++}let W=X[R]||[0,0,0],z=4*(E*o+C);y[z]=W[0],y[z+1]=W[1],y[z+2]=W[2],y[z+3]=255}O.putImageData(D,0,0),await new Promise(E=>setTimeout(E,0))}x=!1,n.x=0,n.y=0}function i(t=1,e=0,l=0){I.clearRect(0,0,o,r),I.save(),I.translate(e,l),I.scale(t,t),I.drawImage(M,0,0),I.restore()}c.addEventListener("mousedown",t=>{s=!0,v.x=t.clientX,v.y=t.clientY,d.x=f,d.y=g,x||(n.x=0,n.y=0)});c.addEventListener("mousemove",t=>{s&&(n.x=t.clientX-v.x,n.y=t.clientY-v.y,i(1,n.x,n.y))});c.addEventListener("mouseup",t=>{s&&(x||(f=d.x-n.x*a,g=d.y-n.y*a,n.x=0,n.y=0,p(),i()),s=!1)});c.addEventListener("mouseleave",()=>{s&&(x||(f=d.x-n.x*a,g=d.y-n.y*a,n.x=0,n.y=0,p(),i()),s=!1)});let b=1,j=null;c.addEventListener("wheel",t=>{t.preventDefault();const e=t.deltaY<0?.9:1.1;a/=e,b*=e,i(b),j&&clearTimeout(j),j=setTimeout(()=>{b=1,p(),i()},300)});c.addEventListener("touchstart",t=>{t.preventDefault(),t.touches.length===1?(s=!0,v.x=t.touches[0].clientX,v.y=t.touches[0].clientY,d.x=f,d.y=g,x||(n.x=0,n.y=0),Y=!1):t.touches.length===2&&(s=!1,Y=!0,V=A(t.touches[0],t.touches[1]),H=G(t.touches[0],t.touches[1]),w=1,L={x:0,y:0},F=H)});c.addEventListener("touchmove",t=>{if(t.preventDefault(),t.touches.length===1&&s)n.x=t.touches[0].clientX-v.x,n.y=t.touches[0].clientY-v.y,i(1,n.x,n.y);else if(t.touches.length===2&&Y){const e=A(t.touches[0],t.touches[1]),l=G(t.touches[0],t.touches[1]);w=e/V,L.x+=l.x-F.x,L.y+=l.y-F.y,F=l,i(w,L.x,L.y)}});c.addEventListener("touchend",t=>{if(t.preventDefault(),s&&(x||(f=d.x-n.x*a,g=d.y-n.y*a,n.x=0,n.y=0,p(),i()),s=!1),Y&&t.touches.length<2){const e=H.x-o/2,l=H.y-r/2;a/=w,f+=e*(a-a*w),g+=l*(a-a*w),w=1,L={x:0,y:0},Y=!1,p(),i()}});tt.addEventListener("click",()=>{f=0,g=0,a=4/o,p(),i()});window.addEventListener("resize",()=>{o=window.innerWidth,r=window.innerHeight,c.width=o,c.height=r,M.width=o,M.height=r,a=4/o,p(),i()});window.addEventListener("DOMContentLoaded",()=>{p(),i()});
//# sourceMappingURL=fractal.js.map
