import"./modulepreload-polyfill.js";import"./modulepreload-polyfill2.js";import"./modulepreload-polyfill22.js";import{N as L,x as _t,T as Ct,F as bt,u as Mt,a as Lt,S as Pt,_ as kt,g as Ot,X as nt,O as zt,c as St,e as At,J as Wt,E as Ht,m as Vt,t as It,z as Rt,U as Ut,h as Xt,i as jt,l as Yt,P as ft,H as Bt,f as Zt,d as qt,j as lt}from"./three.module22.js";import{H as gt}from"./OrbitControls22.js";const $=0,$t=1,Nt=new L,ct=new _t,G=new Ct,dt=new L,q=new bt;class Dt{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new ut,this.unassigned=new ut,this.vertices=[]}setFromPoints(t){if(t.length>=4){this.makeEmpty();for(let e=0,o=t.length;e<o;e++)this.vertices.push(new Gt(t[e]));this._compute()}return this}setFromObject(t){const e=[];return t.updateMatrixWorld(!0),t.traverse(function(o){const s=o.geometry;if(s!==void 0){const i=s.attributes.position;if(i!==void 0)for(let r=0,a=i.count;r<a;r++){const c=new L;c.fromBufferAttribute(i,r).applyMatrix4(o.matrixWorld),e.push(c)}}}),this.setFromPoints(e)}containsPoint(t){const e=this.faces;for(let o=0,s=e.length;o<s;o++)if(e[o].distanceToPoint(t)>this.tolerance)return!1;return!0}intersectRay(t,e){const o=this.faces;let s=-1/0,i=1/0;for(let r=0,a=o.length;r<a;r++){const c=o[r],d=c.distanceToPoint(t.origin),h=c.normal.dot(t.direction);if(d>0&&h>=0)return null;const g=h!==0?-d/h:0;if(!(g<=0)&&(h>0?i=Math.min(g,i):s=Math.max(g,s),s>i))return null}return s!==-1/0?t.at(s,e):t.at(i,e),e}intersectsRay(t){return this.intersectRay(t,Nt)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}_addVertexToFace(t,e){return t.face=e,e.outside===null?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this}_removeVertexFromFace(t,e){return t===e.outside&&(t.next!==null&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this}_removeAllVerticesFromFace(t){if(t.outside!==null){const e=t.outside;let o=t.outside;for(;o.next!==null&&o.next.face===t;)o=o.next;return this.assigned.removeSubList(e,o),e.prev=o.next=null,t.outside=null,e}}_deleteFaceVertices(t,e){const o=this._removeAllVerticesFromFace(t);if(o!==void 0)if(e===void 0)this.unassigned.appendChain(o);else{let s=o;do{const i=s.next;e.distanceToPoint(s.point)>this.tolerance?this._addVertexToFace(s,e):this.unassigned.append(s),s=i}while(s!==null)}return this}_resolveUnassignedPoints(t){if(this.unassigned.isEmpty()===!1){let e=this.unassigned.first();do{const o=e.next;let s=this.tolerance,i=null;for(let r=0;r<t.length;r++){const a=t[r];if(a.mark===$){const c=a.distanceToPoint(e.point);if(c>s&&(s=c,i=a),s>1e3*this.tolerance)break}}i!==null&&this._addVertexToFace(e,i),e=o}while(e!==null)}return this}_computeExtremes(){const t=new L,e=new L,o=[],s=[];for(let i=0;i<3;i++)o[i]=s[i]=this.vertices[0];t.copy(this.vertices[0].point),e.copy(this.vertices[0].point);for(let i=0,r=this.vertices.length;i<r;i++){const a=this.vertices[i],c=a.point;for(let d=0;d<3;d++)c.getComponent(d)<t.getComponent(d)&&(t.setComponent(d,c.getComponent(d)),o[d]=a);for(let d=0;d<3;d++)c.getComponent(d)>e.getComponent(d)&&(e.setComponent(d,c.getComponent(d)),s[d]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(e.x))+Math.max(Math.abs(t.y),Math.abs(e.y))+Math.max(Math.abs(t.z),Math.abs(e.z))),{min:o,max:s}}_computeInitialHull(){const t=this.vertices,e=this._computeExtremes(),o=e.min,s=e.max;let i=0,r=0;for(let l=0;l<3;l++){const m=s[l].point.getComponent(l)-o[l].point.getComponent(l);m>i&&(i=m,r=l)}const a=o[r],c=s[r];let d,h;i=0,ct.set(a.point,c.point);for(let l=0,m=this.vertices.length;l<m;l++){const f=t[l];if(f!==a&&f!==c){ct.closestPointToPoint(f.point,!0,dt);const w=dt.distanceToSquared(f.point);w>i&&(i=w,d=f)}}i=-1,G.setFromCoplanarPoints(a.point,c.point,d.point);for(let l=0,m=this.vertices.length;l<m;l++){const f=t[l];if(f!==a&&f!==c&&f!==d){const w=Math.abs(G.distanceToPoint(f.point));w>i&&(i=w,h=f)}}const g=[];if(G.distanceToPoint(h.point)<0){g.push(P.create(a,c,d),P.create(h,c,a),P.create(h,d,c),P.create(h,a,d));for(let l=0;l<3;l++){const m=(l+1)%3;g[l+1].getEdge(2).setTwin(g[0].getEdge(m)),g[l+1].getEdge(1).setTwin(g[m+1].getEdge(0))}}else{g.push(P.create(a,d,c),P.create(h,a,c),P.create(h,c,d),P.create(h,d,a));for(let l=0;l<3;l++){const m=(l+1)%3;g[l+1].getEdge(2).setTwin(g[0].getEdge((3-l)%3)),g[l+1].getEdge(0).setTwin(g[m+1].getEdge(1))}}for(let l=0;l<4;l++)this.faces.push(g[l]);for(let l=0,m=t.length;l<m;l++){const f=t[l];if(f!==a&&f!==c&&f!==d&&f!==h){i=this.tolerance;let w=null;for(let E=0;E<4;E++){const b=this.faces[E].distanceToPoint(f.point);b>i&&(i=b,w=this.faces[E])}w!==null&&this._addVertexToFace(f,w)}}return this}_reindexFaces(){const t=[];for(let e=0;e<this.faces.length;e++){const o=this.faces[e];o.mark===$&&t.push(o)}return this.faces=t,this}_nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let t,e=0;const o=this.assigned.first().face;let s=o.outside;do{const i=o.distanceToPoint(s.point);i>e&&(e=i,t=s),s=s.next}while(s!==null&&s.face===o);return t}}_computeHorizon(t,e,o,s){this._deleteFaceVertices(o),o.mark=$t;let i;e===null?i=e=o.getEdge(0):i=e.next;do{const r=i.twin,a=r.face;a.mark===$&&(a.distanceToPoint(t)>this.tolerance?this._computeHorizon(t,r,a,s):s.push(i)),i=i.next}while(i!==e);return this}_addAdjoiningFace(t,e){const o=P.create(t,e.tail(),e.head());return this.faces.push(o),o.getEdge(-1).setTwin(e.twin),o.getEdge(0)}_addNewFaces(t,e){this.newFaces=[];let o=null,s=null;for(let i=0;i<e.length;i++){const r=e[i],a=this._addAdjoiningFace(t,r);o===null?o=a:a.next.setTwin(s),this.newFaces.push(a.face),s=a}return o.next.setTwin(s),this}_addVertexToHull(t){const e=[];return this.unassigned.clear(),this._removeVertexFromFace(t,t.face),this._computeHorizon(t.point,null,t.face,e),this._addNewFaces(t,e),this._resolveUnassignedPoints(this.newFaces),this}_cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}_compute(){let t;for(this._computeInitialHull();(t=this._nextVertexToAdd())!==void 0;)this._addVertexToHull(t);return this._reindexFaces(),this._cleanup(),this}}class P{constructor(){this.normal=new L,this.midpoint=new L,this.area=0,this.constant=0,this.outside=null,this.mark=$,this.edge=null}static create(t,e,o){const s=new P,i=new J(t,s),r=new J(e,s),a=new J(o,s);return i.next=a.prev=r,r.next=i.prev=a,a.next=r.prev=i,s.edge=i,s.compute()}getEdge(t){let e=this.edge;for(;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){const t=this.edge.tail(),e=this.edge.head(),o=this.edge.next.head();return q.set(t.point,e.point,o.point),q.getNormal(this.normal),q.getMidpoint(this.midpoint),this.area=q.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class J{constructor(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class Gt{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class ut{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,e){return e.prev=t.prev,e.next=t,e.prev===null?this.head=e:e.prev.next=e,t.prev=e,this}insertAfter(t,e){return e.prev=t,e.next=t.next,e.next===null?this.tail=e:e.next.prev=e,t.next=e,this}append(t){return this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){for(this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail;t.next!==null;)t=t.next;return this.tail=t,this}remove(t){return t.prev===null?this.head=t.next:t.prev.next=t.next,t.next===null?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,e){return t.prev===null?this.head=e.next:t.prev.next=e.next,e.next===null?this.tail=t.prev:e.next.prev=t.prev,this}isEmpty(){return this.head===null}}class Jt extends ft{constructor(t=[]){super();const e=[],o=[],s=new Dt().setFromPoints(t).faces;for(let i=0;i<s.length;i++){const r=s[i];let a=r.edge;do{const c=a.head().point;e.push(c.x,c.y,c.z),o.push(r.normal.x,r.normal.y,r.normal.z),a=a.next}while(a!==r.edge)}this.setAttribute("position",new lt(e,3)),this.setAttribute("normal",new lt(o,3))}}const I=document.getElementById("container");if(!I)throw new Error("container element not found");const V=new Mt;V.background=new Lt(0);const T=new Pt({antialias:!0,preserveDrawingBuffer:!0});T.setPixelRatio(window.devicePixelRatio||1);T.setSize(window.innerWidth,window.innerHeight);I.appendChild(T.domElement);T.domElement.style.pointerEvents="none";const Kt=new kt(16777215,.45);V.add(Kt);const mt=new Ot(16777215,.6);mt.position.set(5,10,7);V.add(mt);const A=document.getElementById("ui");let v=!1,j=0,Y=0;function Qt(n){j=n.clientX,Y=n.clientY,v=z()}function z(){if(!A||A.classList.contains("hidden"))return!1;const n=A.getBoundingClientRect();return j>=n.left&&j<=n.right&&Y>=n.top&&Y<=n.bottom}function _(){T.domElement.style.pointerEvents=v?"none":"auto"}document.addEventListener("mousemove",n=>{Qt(n),_()},{passive:!0});document.addEventListener("mouseleave",()=>{v=!1,_()});window.addEventListener("resize",()=>{v=z(),_()},{passive:!0});var ht;(ht=document.getElementById("toggleUI"))==null||ht.addEventListener("click",()=>{setTimeout(()=>{v=z(),_()},100)});A&&(A.addEventListener("mouseenter",()=>{v=!0,_()}),A.addEventListener("mouseleave",()=>{v=!1,_()}),A.addEventListener("touchstart",()=>{v=!0,_()},{passive:!0}),A.addEventListener("pointerdown",()=>{v=!0,_()},{passive:!0}));function te(n,t,e){const o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s=Math.cos(e),i=Math.sin(e);return o[n][n]=s,o[n][t]=-i,o[t][n]=i,o[t][t]=s,o}function ee(n,t){const e=n[0]*t[0][0]+n[1]*t[1][0]+n[2]*t[2][0]+n[3]*t[3][0],o=n[0]*t[0][1]+n[1]*t[1][1]+n[2]*t[2][1]+n[3]*t[3][1],s=n[0]*t[0][2]+n[1]*t[1][2]+n[2]*t[2][2]+n[3]*t[3][2],i=n[0]*t[0][3]+n[1]*t[1][3]+n[2]*t[2][3]+n[3]*t[3][3];return[e,o,s,i]}function wt([n,t,e,o],s=3,i="perspective"){if(i==="parallel")return new L(n,t,e);const r=s-o,a=Math.abs(r)<1e-9?s:s/r;return new L(n*a,t*a,e*a)}function ot(n){const t=Math.hypot(n[0],n[1],n[2],n[3]);return t===0?n.slice():n.map(e=>e/t)}function ne(){const n=Math.sqrt(5)/5;return[[n,n,n,-3*n],[n,-n,-n,n],[-n,n,-n,n],[-n,-n,n,n],[n,n,-n,n]].map(ot)}function oe(){const n=[],t=[-1,1];for(const e of t)for(const o of t)for(const s of t)for(const i of t)n.push([e,o,s,i]);return n}function se(){const n=[];for(let t=0;t<4;t++)for(const e of[-1,1]){const o=[0,0,0,0];o[t]=e,n.push(o)}return n}function ie(){const n=[];for(let e=0;e<4;e++)for(const o of[-1,1]){const s=[0,0,0,0];s[e]=o,n.push(s)}const t=1/Math.sqrt(2);for(let e=0;e<4;e++)for(let o=e+1;o<4;o++)for(const s of[-1,1])for(const i of[-1,1]){const r=[0,0,0,0];r[e]=s*t,r[o]=i*t,n.push(r)}return n}function vt(n){const t=[];function e(o,s,i){if(s===i)t.push(o.slice());else for(let r=s;r<=i;r++)[o[s],o[r]]=[o[r],o[s]],e(o,s+1,i),[o[s],o[r]]=[o[r],o[s]]}return e(n.slice(),0,n.length-1),t}function pt(n){const t=vt(n),e=[];for(const o of t){let s=0;for(let i=0;i<o.length;i++)for(let r=i+1;r<o.length;r++)n.indexOf(o[i])>n.indexOf(o[r])&&s++;s%2===0&&e.push(o)}return e}function re(){const n=[],t=(1+Math.sqrt(5))/2,e=1/t,o=[[0,1,t,e],[0,1,-t,e],[0,1,t,-e],[0,1,-t,-e]];for(const s of o){const i=pt(s);for(const r of i)for(let a=0;a<16;a++){const c=r.map((d,h)=>a&1<<h?-d:d);n.push(c)}}for(const s of[-1,1])for(const i of[-1,1])for(const r of[-1,1])for(const a of[-1,1])n.push([s,i,r,a]);for(let s=0;s<6;s++){const i=s<3?[t,t,e,e]:[t,e,t,e],r=pt(i);for(const a of r)for(let c=0;c<16;c++){const d=a.map((h,g)=>c&1<<g?-h:h);n.push(d)}}return n.map(ot)}function ae(){const n=[],t=(1+Math.sqrt(5))/2,e=1/t,o=[-.5,.5];for(const i of o)for(const r of o)for(const a of o)for(const c of o)n.push([i,r,a,c]);for(let i=0;i<4;i++)for(const r of[-1,1]){const a=[0,0,0,0];a[i]=r,n.push(a)}const s=vt([0,1,t,e]);for(const i of s)for(let r=0;r<16;r++){if(r===0||r===15)continue;const a=i.map((c,d)=>r&1<<d?-c:c);n.push(a)}return n.map(ot)}function le(n){const t=n.length,e=[];if(t<2)return e;const o=[];for(let h=0;h<t;h++)for(let g=h+1;g<t;g++){let l=0;for(let m=0;m<4;m++){const f=n[h][m]-n[g][m];l+=f*f}l>1e-14&&o.push(l)}if(o.length===0)return e;o.sort((h,g)=>h-g);let s=0,i=0;const r=Math.max(3,Math.floor(o.length*.35));for(let h=0;h<r-1;h++){const g=o[h],l=(o[h+1]-g)/(g||1e-12);l>i&&(i=l,s=h)}const a=(o[s]+o[s+1])/2,c=a*.5,d=a*1.5;for(let h=0;h<t;h++)for(let g=h+1;g<t;g++){let l=0;for(let m=0;m<4;m++){const f=n[h][m]-n[g][m];l+=f*f}l>=c&&l<=d&&e.push([h,g])}if(e.length===0){const h=Math.min(4,t-1),g=new Set;for(let l=0;l<t;l++){const m=[];for(let f=0;f<t;f++)if(l!==f){let w=0;for(let E=0;E<4;E++){const b=n[l][E]-n[f][E];w+=b*b}m.push({j:f,d2:w})}m.sort((f,w)=>f.d2-w.d2);for(let f=0;f<h;f++){const w=l,E=m[f].j,b=w<E?`${w},${E}`:`${E},${w}`;g.has(b)||(g.add(b),e.push([w,E]))}}}return e}const B=new nt,Z=new nt,tt=new nt;V.add(B,Z,tt);let F=null,et=0,K=null,W=null,y=null,X=null;const u={rotationXY:0,rotationXZ:0,rotationYZ:0,rotationXW:0,rotationYW:0,rotationZW:0,showVertices:!0,vertexColor:"#ffcc00",vertexSize:.05,vertexOpacity:1,showEdges:!0,edgeColor:"#44aaff",edgeOpacity:.9,showFaces:!1,faceColor:"#aa44ff",faceOpacity:.3,projectionType:"perspective"};let M=[],S=[];function ce(n){F&&et>=n||(F&&(F.geometry.dispose(),W.dispose(),B.remove(F),F=null,K=null,W=null),K=new Ut(1,10,10),W=new Xt({color:u.vertexColor,flatShading:!1}),F=new jt(K,W,n),F.instanceMatrix.setUsage(Yt),F.castShadow=!1,F.receiveShadow=!1,B.add(F),et=n)}function de(n){const t=Math.max(0,n*2);if(y&&X&&X.length>=t*3)return;y&&(y.geometry.dispose(),Z.remove(y),y=null,X=null),X=new Float32Array(t*3||3);const e=new ft;e.setAttribute("position",new Bt(X,3));const o=new Zt({color:u.edgeColor,transparent:u.edgeOpacity<1,opacity:u.edgeOpacity});y=new qt(e,o),y.frustumCulled=!1,Z.add(y)}function x(){Q(tt);let n=M.map(e=>e.slice());const t=[[0,1,u.rotationXY],[0,2,u.rotationXZ],[1,2,u.rotationYZ],[0,3,u.rotationXW],[1,3,u.rotationYW],[2,3,u.rotationZW]];for(const[e,o,s]of t)if(Math.abs(s)>1e-12){const i=te(e,o,s);n=n.map(r=>ee(r,i))}if(S=n.map(e=>wt(e,3,u.projectionType)),Q(B),u.showVertices&&S.length>0){ce(S.length),W.color.set(u.vertexColor),W.opacity=u.vertexOpacity,W.transparent=u.vertexOpacity<1;const e=new Wt,o=Math.max(1e-4,u.vertexSize);for(let s=0;s<S.length;s++){const i=S[s];e.compose(i,new Ht,new L(o,o,o)),F.setMatrixAt(s,e)}F.count=S.length,F.instanceMatrix.needsUpdate=!0,B.add(F)}else F&&(F.count=0);if(Q(Z),u.showEdges&&M.length>=2){const e=le(M);de(e.length);const o=y.geometry.attributes.position.array;let s=0;for(let i=0;i<e.length;i++){const[r,a]=e[i],c=S[r],d=S[a];!c||!d||(o[s++]=c.x,o[s++]=c.y,o[s++]=c.z,o[s++]=d.x,o[s++]=d.y,o[s++]=d.z)}for(;s<o.length;s++)o[s]=0;y.geometry.attributes.position.needsUpdate=!0,y.material.color.set(u.edgeColor),y.material.opacity=u.edgeOpacity,y.material.transparent=u.edgeOpacity<1,Z.add(y)}if(u.showFaces&&S.length>=4)try{const e=new Jt(S),o=new Vt({color:u.faceColor,transparent:u.faceOpacity<1,opacity:u.faceOpacity,side:It,depthWrite:!1}),s=new Rt(e,o);s.renderOrder=2,tt.add(s)}catch(e){console.warn("ConvexGeometry failed to build hull:",e)}}function Q(n){for(;n.children.length;){const t=n.children[0];n.remove(t),t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(e=>e.dispose()):t.material.dispose())}}let k,O,H,C;function xt(){const n=window.innerWidth/window.innerHeight;k=new zt(60,n,.01,1e3),k.position.set(3,3,3),k.lookAt(0,0,0);const t=4;O=new St(-t*n/2,t*n/2,t/2,-t/2,-1e3,1e3),O.position.copy(k.position),O.lookAt(0,0,0),H=k,C&&C.dispose(),C=new gt(H,I),C.enableDamping=!0,C.enabled=!0,v=z(),_()}xt();window.addEventListener("resize",()=>{const n=window.innerWidth/window.innerHeight;k.aspect=n,k.updateProjectionMatrix();const t=4;O.left=-t*n/2,O.right=t*n/2,O.top=t/2,O.bottom=-t/2,O.updateProjectionMatrix(),T.setSize(window.innerWidth,window.innerHeight),v=z(),_()});function ue(){const n=p=>document.getElementById(p),t=n("showVerts"),e=n("vertColor"),o=n("vertSize"),s=n("showEdges"),i=n("edgeColor"),r=n("edgeOpacity"),a=n("showFaces"),c=n("faceColor"),d=n("faceOpacity"),h=n("rotXY"),g=n("rotXZ"),l=n("rotYZ"),m=n("rotXW"),f=n("rotYW"),w=n("rotZW"),E=n("projectionType"),b=n("toggleUI"),D=n("ui"),it=n("fullscreenBtn"),rt=n("renderBtn"),Et=n("resMult"),R=n("progress"),at=n("polytopeSelect");t&&t.addEventListener("change",p=>{u.showVertices=p.target.checked,x()}),e&&e.addEventListener("input",p=>{u.vertexColor=p.target.value,W&&W.color.set(p.target.value),x()}),o&&o.addEventListener("input",p=>{u.vertexSize=parseFloat(p.target.value),x()}),s&&s.addEventListener("change",p=>{u.showEdges=p.target.checked,x()}),i&&i.addEventListener("input",p=>{u.edgeColor=p.target.value,y&&y.material.color.set(p.target.value),x()}),r&&r.addEventListener("input",p=>{u.edgeOpacity=parseFloat(p.target.value),y&&(y.material.opacity=u.edgeOpacity,y.material.transparent=u.edgeOpacity<1),x()}),a&&a.addEventListener("change",p=>{u.showFaces=p.target.checked,x()}),c&&c.addEventListener("input",p=>{u.faceColor=p.target.value,x()}),d&&d.addEventListener("input",p=>{u.faceOpacity=parseFloat(p.target.value),x()}),h&&h.addEventListener("input",p=>{u.rotationXY=parseFloat(p.target.value),x()}),g&&g.addEventListener("input",p=>{u.rotationXZ=parseFloat(p.target.value),x()}),l&&l.addEventListener("input",p=>{u.rotationYZ=parseFloat(p.target.value),x()}),m&&m.addEventListener("input",p=>{u.rotationXW=parseFloat(p.target.value),x()}),f&&f.addEventListener("input",p=>{u.rotationYW=parseFloat(p.target.value),x()}),w&&w.addEventListener("input",p=>{u.rotationZW=parseFloat(p.target.value),x()}),E&&E.addEventListener("change",p=>{u.projectionType=p.target.value,H=u.projectionType==="parallel"?O:k,C&&C.dispose(),C=new gt(H,I),C.enableDamping=!0,N(),x()}),b&&D&&b.addEventListener("click",()=>{D.classList.toggle("hidden"),b.textContent=D.classList.contains("hidden")?"Show UI":"Hide UI",setTimeout(()=>{v=z(),_()},100)}),it&&I&&it.addEventListener("click",async()=>{try{document.fullscreenElement?(await document.exitFullscreen(),setTimeout(()=>{window.dispatchEvent(new Event("resize")),v=z(),_()},300)):(await I.requestFullscreen(),setTimeout(()=>{window.dispatchEvent(new Event("resize")),v=z(),_()},300))}catch(p){alert("Fullscreen failed: "+p.message)}}),rt&&rt.addEventListener("click",async()=>{R.textContent="Rendering...";try{const p=Math.max(1,parseInt(Et.value||"1",10)),Ft=T.getPixelRatio();T.setPixelRatio((window.devicePixelRatio||1)*p),T.setSize(Math.round(window.innerWidth),Math.round(window.innerHeight),!1),await new Promise(requestAnimationFrame),T.render(V,H),await new Promise(requestAnimationFrame);const Tt=T.domElement.toDataURL("image/png");T.setPixelRatio(Ft),T.setSize(window.innerWidth,window.innerHeight,!1);const U=document.createElement("a");U.href=Tt,U.download=`4d_polytope_${Date.now()}.png`,document.body.appendChild(U),U.click(),document.body.removeChild(U),R.textContent="Saved!",setTimeout(()=>R.textContent="",1500)}catch(p){console.error(p),R.textContent="Render failed",setTimeout(()=>R.textContent="",2e3)}}),at&&at.addEventListener("change",p=>{st(p.target.value),N(),x()})}function st(n){switch(n){case"4-simplex":M=ne();break;case"hypercube":M=oe();break;case"16-cell":M=se();break;case"24-cell":M=ie();break;case"120-cell":M=re();break;case"600-cell":M=ae();break;default:M=[]}et=0}function N(){if(!M.length)return;const n=M.map(i=>wt(i,3,u.projectionType)),t=new At().setFromPoints(n),e=t.getCenter(new L),o=t.getSize(new L).length(),s=Math.max(2,o*1.6);k.position.set(e.x+s,e.y+s,e.z+s),k.lookAt(e),O.position.copy(k.position),O.lookAt(e),C&&(C.target.copy(e),C.update())}st("24-cell");ue();xt();N();x();v=z();_();function yt(){requestAnimationFrame(yt),j!==void 0&&Y!==void 0&&(v=z(),_()),C&&C.update(),T.render(V,H)}yt();window.__poly={loadPolytope:st,updateGeometry:x,boundsToCamera:N,scene:V,renderer:T,camera:()=>H,__isOverUI:()=>v,__checkUI:()=>(v=z(),_(),v),__debug:()=>{console.log({isOverUI:v,mousePos:[j,Y],uiRect:A?A.getBoundingClientRect():null,canvasPointerEvents:T.domElement.style.pointerEvents})}};
//# sourceMappingURL=polytopes.js.map
