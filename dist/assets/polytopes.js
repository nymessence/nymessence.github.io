import"./modulepreload-polyfill.js";import{R as _e,g as Te,z as be,b as Le,U as Me,q as ne,N as M,h as Pe,E as ke,i as ze,J as Oe,A as Ae,O as Se,j as We,k as Ve,l as He,m as Ie,C as Re,w as Ue,P as fe,H as je,D as qe,a as Xe,I as Ye,t as Be,d as Ze,n as le}from"./three.module22.js";import{H as ge}from"./OrbitControls22.js";const D=0,De=1,Ne=new M,ce=new Pe,G=new ke,de=new M,Z=new ze;class $e{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new he,this.unassigned=new he,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,o=e.length;t<o;t++)this.vertices.push(new Ge(e[t]));this._compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(o){const s=o.geometry;if(s!==void 0){const i=s.attributes.position;if(i!==void 0)for(let r=0,a=i.count;r<a;r++){const c=new M;c.fromBufferAttribute(i,r).applyMatrix4(o.matrixWorld),t.push(c)}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let o=0,s=t.length;o<s;o++)if(t[o].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const o=this.faces;let s=-1/0,i=1/0;for(let r=0,a=o.length;r<a;r++){const c=o[r],d=c.distanceToPoint(e.origin),u=c.normal.dot(e.direction);if(d>0&&u>=0)return null;const g=u!==0?-d/u:0;if(!(g<=0)&&(u>0?i=Math.min(g,i):s=Math.max(g,s),s>i))return null}return s!==-1/0?e.at(s,t):e.at(i,t),t}intersectsRay(e){return this.intersectRay(e,Ne)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}_addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}_removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}_removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let o=e.outside;for(;o.next!==null&&o.next.face===e;)o=o.next;return this.assigned.removeSubList(t,o),t.prev=o.next=null,e.outside=null,t}}_deleteFaceVertices(e,t){const o=this._removeAllVerticesFromFace(e);if(o!==void 0)if(t===void 0)this.unassigned.appendChain(o);else{let s=o;do{const i=s.next;t.distanceToPoint(s.point)>this.tolerance?this._addVertexToFace(s,t):this.unassigned.append(s),s=i}while(s!==null)}return this}_resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const o=t.next;let s=this.tolerance,i=null;for(let r=0;r<e.length;r++){const a=e[r];if(a.mark===D){const c=a.distanceToPoint(t.point);if(c>s&&(s=c,i=a),s>1e3*this.tolerance)break}}i!==null&&this._addVertexToFace(t,i),t=o}while(t!==null)}return this}_computeExtremes(){const e=new M,t=new M,o=[],s=[];for(let i=0;i<3;i++)o[i]=s[i]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let i=0,r=this.vertices.length;i<r;i++){const a=this.vertices[i],c=a.point;for(let d=0;d<3;d++)c.getComponent(d)<e.getComponent(d)&&(e.setComponent(d,c.getComponent(d)),o[d]=a);for(let d=0;d<3;d++)c.getComponent(d)>t.getComponent(d)&&(t.setComponent(d,c.getComponent(d)),s[d]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:o,max:s}}_computeInitialHull(){const e=this.vertices,t=this._computeExtremes(),o=t.min,s=t.max;let i=0,r=0;for(let l=0;l<3;l++){const m=s[l].point.getComponent(l)-o[l].point.getComponent(l);m>i&&(i=m,r=l)}const a=o[r],c=s[r];let d,u;i=0,ce.set(a.point,c.point);for(let l=0,m=this.vertices.length;l<m;l++){const f=e[l];if(f!==a&&f!==c){ce.closestPointToPoint(f.point,!0,de);const w=de.distanceToSquared(f.point);w>i&&(i=w,d=f)}}i=-1,G.setFromCoplanarPoints(a.point,c.point,d.point);for(let l=0,m=this.vertices.length;l<m;l++){const f=e[l];if(f!==a&&f!==c&&f!==d){const w=Math.abs(G.distanceToPoint(f.point));w>i&&(i=w,u=f)}}const g=[];if(G.distanceToPoint(u.point)<0){g.push(P.create(a,c,d),P.create(u,c,a),P.create(u,d,c),P.create(u,a,d));for(let l=0;l<3;l++){const m=(l+1)%3;g[l+1].getEdge(2).setTwin(g[0].getEdge(m)),g[l+1].getEdge(1).setTwin(g[m+1].getEdge(0))}}else{g.push(P.create(a,d,c),P.create(u,a,c),P.create(u,c,d),P.create(u,d,a));for(let l=0;l<3;l++){const m=(l+1)%3;g[l+1].getEdge(2).setTwin(g[0].getEdge((3-l)%3)),g[l+1].getEdge(0).setTwin(g[m+1].getEdge(1))}}for(let l=0;l<4;l++)this.faces.push(g[l]);for(let l=0,m=e.length;l<m;l++){const f=e[l];if(f!==a&&f!==c&&f!==d&&f!==u){i=this.tolerance;let w=null;for(let E=0;E<4;E++){const b=this.faces[E].distanceToPoint(f.point);b>i&&(i=b,w=this.faces[E])}w!==null&&this._addVertexToFace(f,w)}}return this}_reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const o=this.faces[t];o.mark===D&&e.push(o)}return this.faces=e,this}_nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const o=this.assigned.first().face;let s=o.outside;do{const i=o.distanceToPoint(s.point);i>t&&(t=i,e=s),s=s.next}while(s!==null&&s.face===o);return e}}_computeHorizon(e,t,o,s){this._deleteFaceVertices(o),o.mark=De;let i;t===null?i=t=o.getEdge(0):i=t.next;do{const r=i.twin,a=r.face;a.mark===D&&(a.distanceToPoint(e)>this.tolerance?this._computeHorizon(e,r,a,s):s.push(i)),i=i.next}while(i!==t);return this}_addAdjoiningFace(e,t){const o=P.create(e,t.tail(),t.head());return this.faces.push(o),o.getEdge(-1).setTwin(t.twin),o.getEdge(0)}_addNewFaces(e,t){this.newFaces=[];let o=null,s=null;for(let i=0;i<t.length;i++){const r=t[i],a=this._addAdjoiningFace(e,r);o===null?o=a:a.next.setTwin(s),this.newFaces.push(a.face),s=a}return o.next.setTwin(s),this}_addVertexToHull(e){const t=[];return this.unassigned.clear(),this._removeVertexFromFace(e,e.face),this._computeHorizon(e.point,null,e.face,t),this._addNewFaces(e,t),this._resolveUnassignedPoints(this.newFaces),this}_cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}_compute(){let e;for(this._computeInitialHull();(e=this._nextVertexToAdd())!==void 0;)this._addVertexToHull(e);return this._reindexFaces(),this._cleanup(),this}}class P{constructor(){this.normal=new M,this.midpoint=new M,this.area=0,this.constant=0,this.outside=null,this.mark=D,this.edge=null}static create(e,t,o){const s=new P,i=new J(e,s),r=new J(t,s),a=new J(o,s);return i.next=a.prev=r,r.next=i.prev=a,a.next=r.prev=i,s.edge=i,s.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),o=this.edge.next.head();return Z.set(e.point,t.point,o.point),Z.getNormal(this.normal),Z.getMidpoint(this.midpoint),this.area=Z.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class J{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class Ge{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class he{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}}class Je extends fe{constructor(e=[]){super();const t=[],o=[],s=new $e().setFromPoints(e).faces;for(let i=0;i<s.length;i++){const r=s[i];let a=r.edge;do{const c=a.head().point;t.push(c.x,c.y,c.z),o.push(r.normal.x,r.normal.y,r.normal.z),a=a.next}while(a!==r.edge)}this.setAttribute("position",new le(t,3)),this.setAttribute("normal",new le(o,3))}}const I=document.getElementById("container");if(!I)throw new Error("container element not found");const H=new _e;H.background=new Te(0);const C=new be({antialias:!0,preserveDrawingBuffer:!0});C.setPixelRatio(window.devicePixelRatio||1);C.setSize(window.innerWidth,window.innerHeight);I.appendChild(C.domElement);C.domElement.style.pointerEvents="none";const Ke=new Le(16777215,.45);H.add(Ke);const me=new Me(16777215,.6);me.position.set(5,10,7);H.add(me);const S=document.getElementById("ui");let v=!1,q=0,X=0;function Qe(n){q=n.clientX,X=n.clientY,v=O()}function O(){if(!S||S.classList.contains("hidden"))return!1;const n=S.getBoundingClientRect();return q>=n.left&&q<=n.right&&X>=n.top&&X<=n.bottom}function _(){C.domElement.style.pointerEvents=v?"none":"auto"}document.addEventListener("mousemove",n=>{Qe(n),_()},{passive:!0});document.addEventListener("mouseleave",()=>{v=!1,_()});window.addEventListener("resize",()=>{v=O(),_()},{passive:!0});var ue;(ue=document.getElementById("toggleUI"))==null||ue.addEventListener("click",()=>{setTimeout(()=>{v=O(),_()},100)});S&&(S.addEventListener("mouseenter",()=>{v=!0,_()}),S.addEventListener("mouseleave",()=>{v=!1,_()}),S.addEventListener("touchstart",()=>{v=!0,_()},{passive:!0}),S.addEventListener("pointerdown",()=>{v=!0,_()},{passive:!0}));function et(n,e,t){const o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s=Math.cos(t),i=Math.sin(t);return o[n][n]=s,o[n][e]=-i,o[e][n]=i,o[e][e]=s,o}function tt(n,e){const t=n[0]*e[0][0]+n[1]*e[1][0]+n[2]*e[2][0]+n[3]*e[3][0],o=n[0]*e[0][1]+n[1]*e[1][1]+n[2]*e[2][1]+n[3]*e[3][1],s=n[0]*e[0][2]+n[1]*e[1][2]+n[2]*e[2][2]+n[3]*e[3][2],i=n[0]*e[0][3]+n[1]*e[1][3]+n[2]*e[2][3]+n[3]*e[3][3];return[t,o,s,i]}function we([n,e,t,o],s=3,i="perspective"){if(i==="parallel")return new M(n,e,t);const r=s-o,a=Math.abs(r)<1e-9?s:s/r;return new M(n*a,e*a,t*a)}function oe(n){const e=Math.hypot(n[0],n[1],n[2],n[3]);return e===0?n.slice():n.map(t=>t/e)}function nt(){const n=Math.sqrt(5)/5;return[[n,n,n,-3*n],[n,-n,-n,n],[-n,n,-n,n],[-n,-n,n,n],[n,n,-n,n]].map(oe)}function ot(){const n=[],e=[-1,1];for(const t of e)for(const o of e)for(const s of e)for(const i of e)n.push([t,o,s,i]);return n}function st(){const n=[];for(let e=0;e<4;e++)for(const t of[-1,1]){const o=[0,0,0,0];o[e]=t,n.push(o)}return n}function it(){const n=[];for(let t=0;t<4;t++)for(const o of[-1,1]){const s=[0,0,0,0];s[t]=o,n.push(s)}const e=1/Math.sqrt(2);for(let t=0;t<4;t++)for(let o=t+1;o<4;o++)for(const s of[-1,1])for(const i of[-1,1]){const r=[0,0,0,0];r[t]=s*e,r[o]=i*e,n.push(r)}return n}function ve(n){const e=[];function t(o,s,i){if(s===i)e.push(o.slice());else for(let r=s;r<=i;r++)[o[s],o[r]]=[o[r],o[s]],t(o,s+1,i),[o[s],o[r]]=[o[r],o[s]]}return t(n.slice(),0,n.length-1),e}function pe(n){const e=ve(n),t=[];for(const o of e){let s=0;for(let i=0;i<o.length;i++)for(let r=i+1;r<o.length;r++)n.indexOf(o[i])>n.indexOf(o[r])&&s++;s%2===0&&t.push(o)}return t}function rt(){const n=[],e=(1+Math.sqrt(5))/2,t=1/e,o=[[0,1,e,t],[0,1,-e,t],[0,1,e,-t],[0,1,-e,-t]];for(const s of o){const i=pe(s);for(const r of i)for(let a=0;a<16;a++){const c=r.map((d,u)=>a&1<<u?-d:d);n.push(c)}}for(const s of[-1,1])for(const i of[-1,1])for(const r of[-1,1])for(const a of[-1,1])n.push([s,i,r,a]);for(let s=0;s<6;s++){const i=s<3?[e,e,t,t]:[e,t,e,t],r=pe(i);for(const a of r)for(let c=0;c<16;c++){const d=a.map((u,g)=>c&1<<g?-u:u);n.push(d)}}return n.map(oe)}function at(){const n=[],e=(1+Math.sqrt(5))/2,t=1/e,o=[-.5,.5];for(const i of o)for(const r of o)for(const a of o)for(const c of o)n.push([i,r,a,c]);for(let i=0;i<4;i++)for(const r of[-1,1]){const a=[0,0,0,0];a[i]=r,n.push(a)}const s=ve([0,1,e,t]);for(const i of s)for(let r=0;r<16;r++){if(r===0||r===15)continue;const a=i.map((c,d)=>r&1<<d?-c:c);n.push(a)}return n.map(oe)}function lt(n){const e=n.length,t=[];if(e<2)return t;const o=[];for(let u=0;u<e;u++)for(let g=u+1;g<e;g++){let l=0;for(let m=0;m<4;m++){const f=n[u][m]-n[g][m];l+=f*f}l>1e-14&&o.push(l)}if(o.length===0)return t;o.sort((u,g)=>u-g);let s=0,i=0;const r=Math.max(3,Math.floor(o.length*.35));for(let u=0;u<r-1;u++){const g=o[u],l=(o[u+1]-g)/(g||1e-12);l>i&&(i=l,s=u)}const a=(o[s]+o[s+1])/2,c=a*.5,d=a*1.5;for(let u=0;u<e;u++)for(let g=u+1;g<e;g++){let l=0;for(let m=0;m<4;m++){const f=n[u][m]-n[g][m];l+=f*f}l>=c&&l<=d&&t.push([u,g])}if(t.length===0){const u=Math.min(4,e-1),g=new Set;for(let l=0;l<e;l++){const m=[];for(let f=0;f<e;f++)if(l!==f){let w=0;for(let E=0;E<4;E++){const b=n[l][E]-n[f][E];w+=b*b}m.push({j:f,d2:w})}m.sort((f,w)=>f.d2-w.d2);for(let f=0;f<u;f++){const w=l,E=m[f].j,b=w<E?`${w},${E}`:`${E},${w}`;g.has(b)||(g.add(b),t.push([w,E]))}}}return t}const Y=new ne,B=new ne,ee=new ne;H.add(Y,B,ee);let F=null,te=0,K=null,W=null,y=null,j=null;const h={rotationXY:0,rotationXZ:0,rotationYZ:0,rotationXW:0,rotationYW:0,rotationZW:0,showVertices:!0,vertexColor:"#ffcc00",vertexSize:.05,vertexOpacity:1,showEdges:!0,edgeColor:"#44aaff",edgeOpacity:.9,showFaces:!1,faceColor:"#aa44ff",faceOpacity:.3,projectionType:"perspective"};let L=[],A=[];function ct(n){F&&te>=n||(F&&(F.geometry.dispose(),W.dispose(),Y.remove(F),F=null,K=null,W=null),K=new He(1,10,10),W=new Ie({color:h.vertexColor,flatShading:!1}),F=new Re(K,W,n),F.instanceMatrix.setUsage(Ue),F.castShadow=!1,F.receiveShadow=!1,Y.add(F),te=n)}function dt(n){const e=Math.max(0,n*2);if(y&&j&&j.length>=e*3)return;y&&(y.geometry.dispose(),B.remove(y),y=null,j=null),j=new Float32Array(e*3||3);const t=new fe;t.setAttribute("position",new je(j,3));const o=new qe({color:h.edgeColor,transparent:h.edgeOpacity<1,opacity:h.edgeOpacity});y=new Xe(t,o),y.frustumCulled=!1,B.add(y)}function x(){Q(ee);let n=L.map(t=>t.slice());const e=[[0,1,h.rotationXY],[0,2,h.rotationXZ],[1,2,h.rotationYZ],[0,3,h.rotationXW],[1,3,h.rotationYW],[2,3,h.rotationZW]];for(const[t,o,s]of e)if(Math.abs(s)>1e-12){const i=et(t,o,s);n=n.map(r=>tt(r,i))}if(A=n.map(t=>we(t,3,h.projectionType)),Q(Y),h.showVertices&&A.length>0){ct(A.length),W.color.set(h.vertexColor),W.opacity=h.vertexOpacity,W.transparent=h.vertexOpacity<1;const t=new Oe,o=Math.max(1e-4,h.vertexSize);for(let s=0;s<A.length;s++){const i=A[s];t.compose(i,new Ae,new M(o,o,o)),F.setMatrixAt(s,t)}F.count=A.length,F.instanceMatrix.needsUpdate=!0,Y.add(F)}else F&&(F.count=0);if(Q(B),h.showEdges&&L.length>=2){const t=lt(L);dt(t.length);const o=y.geometry.attributes.position.array;let s=0;for(let i=0;i<t.length;i++){const[r,a]=t[i],c=A[r],d=A[a];!c||!d||(o[s++]=c.x,o[s++]=c.y,o[s++]=c.z,o[s++]=d.x,o[s++]=d.y,o[s++]=d.z)}for(;s<o.length;s++)o[s]=0;y.geometry.attributes.position.needsUpdate=!0,y.material.color.set(h.edgeColor),y.material.opacity=h.edgeOpacity,y.material.transparent=h.edgeOpacity<1,B.add(y)}if(h.showFaces&&A.length>=4)try{const t=new Je(A),o=new Ye({color:h.faceColor,transparent:h.faceOpacity<1,opacity:h.faceOpacity,side:Be,depthWrite:!1}),s=new Ze(t,o);s.renderOrder=2,ee.add(s)}catch(t){console.warn("ConvexGeometry failed to build hull:",t)}}function Q(n){for(;n.children.length;){const e=n.children[0];n.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose())}}let k,z,V,T;function xe(){const n=window.innerWidth/window.innerHeight;k=new Se(60,n,.01,1e3),k.position.set(3,3,3),k.lookAt(0,0,0);const e=4;z=new We(-e*n/2,e*n/2,e/2,-e/2,-1e3,1e3),z.position.copy(k.position),z.lookAt(0,0,0),V=k,T&&T.dispose(),T=new ge(V,I),T.enableDamping=!0,T.enabled=!0,v=O(),_()}xe();window.addEventListener("resize",()=>{const n=window.innerWidth/window.innerHeight;k.aspect=n,k.updateProjectionMatrix();const e=4;z.left=-e*n/2,z.right=e*n/2,z.top=e/2,z.bottom=-e/2,z.updateProjectionMatrix(),C.setSize(window.innerWidth,window.innerHeight),v=O(),_()});function ht(){const n=p=>document.getElementById(p),e=n("showVerts"),t=n("vertColor"),o=n("vertSize"),s=n("showEdges"),i=n("edgeColor"),r=n("edgeOpacity"),a=n("showFaces"),c=n("faceColor"),d=n("faceOpacity"),u=n("rotXY"),g=n("rotXZ"),l=n("rotYZ"),m=n("rotXW"),f=n("rotYW"),w=n("rotZW"),E=n("projectionType"),b=n("toggleUI"),$=n("ui"),ie=n("fullscreenBtn"),re=n("renderBtn"),Ee=n("resMult"),R=n("progress"),ae=n("polytopeSelect");e&&e.addEventListener("change",p=>{h.showVertices=p.target.checked,x()}),t&&t.addEventListener("input",p=>{h.vertexColor=p.target.value,W&&W.color.set(p.target.value),x()}),o&&o.addEventListener("input",p=>{h.vertexSize=parseFloat(p.target.value),x()}),s&&s.addEventListener("change",p=>{h.showEdges=p.target.checked,x()}),i&&i.addEventListener("input",p=>{h.edgeColor=p.target.value,y&&y.material.color.set(p.target.value),x()}),r&&r.addEventListener("input",p=>{h.edgeOpacity=parseFloat(p.target.value),y&&(y.material.opacity=h.edgeOpacity,y.material.transparent=h.edgeOpacity<1),x()}),a&&a.addEventListener("change",p=>{h.showFaces=p.target.checked,x()}),c&&c.addEventListener("input",p=>{h.faceColor=p.target.value,x()}),d&&d.addEventListener("input",p=>{h.faceOpacity=parseFloat(p.target.value),x()}),u&&u.addEventListener("input",p=>{h.rotationXY=parseFloat(p.target.value),x()}),g&&g.addEventListener("input",p=>{h.rotationXZ=parseFloat(p.target.value),x()}),l&&l.addEventListener("input",p=>{h.rotationYZ=parseFloat(p.target.value),x()}),m&&m.addEventListener("input",p=>{h.rotationXW=parseFloat(p.target.value),x()}),f&&f.addEventListener("input",p=>{h.rotationYW=parseFloat(p.target.value),x()}),w&&w.addEventListener("input",p=>{h.rotationZW=parseFloat(p.target.value),x()}),E&&E.addEventListener("change",p=>{h.projectionType=p.target.value,V=h.projectionType==="parallel"?z:k,T&&T.dispose(),T=new ge(V,I),T.enableDamping=!0,N(),x()}),b&&$&&b.addEventListener("click",()=>{$.classList.toggle("hidden"),b.textContent=$.classList.contains("hidden")?"Show UI":"Hide UI",setTimeout(()=>{v=O(),_()},100)}),ie&&I&&ie.addEventListener("click",async()=>{try{document.fullscreenElement?(await document.exitFullscreen(),setTimeout(()=>{window.dispatchEvent(new Event("resize")),v=O(),_()},300)):(await I.requestFullscreen(),setTimeout(()=>{window.dispatchEvent(new Event("resize")),v=O(),_()},300))}catch(p){alert("Fullscreen failed: "+p.message)}}),re&&re.addEventListener("click",async()=>{R.textContent="Rendering...";try{const p=Math.max(1,parseInt(Ee.value||"1",10)),Fe=C.getPixelRatio();C.setPixelRatio((window.devicePixelRatio||1)*p),C.setSize(Math.round(window.innerWidth),Math.round(window.innerHeight),!1),await new Promise(requestAnimationFrame),C.render(H,V),await new Promise(requestAnimationFrame);const Ce=C.domElement.toDataURL("image/png");C.setPixelRatio(Fe),C.setSize(window.innerWidth,window.innerHeight,!1);const U=document.createElement("a");U.href=Ce,U.download=`4d_polytope_${Date.now()}.png`,document.body.appendChild(U),U.click(),document.body.removeChild(U),R.textContent="Saved!",setTimeout(()=>R.textContent="",1500)}catch(p){console.error(p),R.textContent="Render failed",setTimeout(()=>R.textContent="",2e3)}}),ae&&ae.addEventListener("change",p=>{se(p.target.value),N(),x()})}function se(n){switch(n){case"4-simplex":L=nt();break;case"hypercube":L=ot();break;case"16-cell":L=st();break;case"24-cell":L=it();break;case"120-cell":L=rt();break;case"600-cell":L=at();break;default:L=[]}te=0}function N(){if(!L.length)return;const n=L.map(i=>we(i,3,h.projectionType)),e=new Ve().setFromPoints(n),t=e.getCenter(new M),o=e.getSize(new M).length(),s=Math.max(2,o*1.6);k.position.set(t.x+s,t.y+s,t.z+s),k.lookAt(t),z.position.copy(k.position),z.lookAt(t),T&&(T.target.copy(t),T.update())}se("24-cell");ht();xe();N();x();v=O();_();function ye(){requestAnimationFrame(ye),q!==void 0&&X!==void 0&&(v=O(),_()),T&&T.update(),C.render(H,V)}ye();window.__poly={loadPolytope:se,updateGeometry:x,boundsToCamera:N,scene:H,renderer:C,camera:()=>V,__isOverUI:()=>v,__checkUI:()=>(v=O(),_(),v),__debug:()=>{console.log({isOverUI:v,mousePos:[q,X],uiRect:S?S.getBoundingClientRect():null,canvasPointerEvents:C.domElement.style.pointerEvents})}};
//# sourceMappingURL=polytopes.js.map
