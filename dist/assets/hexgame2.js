import{W as se,S as ie,P as ae,A as re,D as ce,G as X,B as le,a as fe,L as de,b as me,C as K,M as v,c as C,d as ue,O as he,T as pe,V as N}from"./three.module.js";import{O as we}from"./OrbitControls.js";const J=document.getElementById("bgCanvas");if(!J)throw new Error("Canvas element with id 'bgCanvas' not found");const x=new se({canvas:J,alpha:!0,antialias:!0});x.setSize(window.innerWidth,window.innerHeight);x.setPixelRatio(window.devicePixelRatio);x.setClearColor(0,0);const G=new ie,b=new ae(60,window.innerWidth/window.innerHeight,.1,1e3);b.position.set(0,8,15);window.addEventListener("resize",()=>{b.aspect=window.innerWidth/window.innerHeight,b.updateProjectionMatrix(),x.setSize(window.innerWidth,window.innerHeight)});G.add(new re(16777215,.5));const Q=new ce(16777215,.8);Q.position.set(5,10,7.5);G.add(Q);const E=new we(b,x.domElement);E.enablePan=!1;E.enableZoom=!1;E.target.set(0,0,0);let $;const I=[[1,1,0,0],[1,-1,0,0],[-1,1,0,0],[-1,-1,0,0],[1,0,1,0],[1,0,-1,0],[-1,0,1,0],[-1,0,-1,0],[0,1,1,0],[0,1,-1,0],[0,-1,1,0],[0,-1,-1,0],[1,0,0,1],[1,0,0,-1],[-1,0,0,1],[-1,0,0,-1],[0,1,0,1],[0,1,0,-1],[0,-1,0,1],[0,-1,0,-1],[0,0,1,1],[0,0,1,-1],[0,0,-1,1],[0,0,-1,-1]],Z=[];function ge(e,n){return e.reduce((o,t,s)=>o+(t-n[s])**2,0)}for(let e=0;e<I.length;e++)for(let n=e+1;n<I.length;n++)Math.abs(ge(I[e],I[n])-2)<.01&&Z.push([e,n]);function ye(e,n,o){const t=Array(4).fill(0).map(()=>Array(4).fill(0));for(let s=0;s<4;s++)t[s][s]=1;return t[e][e]=Math.cos(o),t[e][n]=-Math.sin(o),t[n][e]=Math.sin(o),t[n][n]=Math.cos(o),t}function Me(e,n){return e.map((o,t)=>o.reduce((s,i,r)=>s+i*n[r],0))}function be(e,n){const o=Array(4).fill(0).map(()=>Array(4).fill(0));for(let t=0;t<4;t++)for(let s=0;s<4;s++)for(let i=0;i<4;i++)o[t][s]+=e[t][i]*n[i][s];return o}function xe(e){return e.reduce((n,o)=>be(n,o))}function Pe(e,n=6){const o=n-e[3],t=o<.1?.1:o;return new N(e[0]*n/t,e[1]*n/t,e[2]*n/t)}const V=[[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]];let W=V.map(()=>0),Ie=V.map(()=>(Math.random()*.001+3e-4)*(Math.random()<.5?1:-1)),h,A,_;function ve(){$=new X,h=new Float32Array(Z.length*2*3),A=new le,A.setAttribute("position",new fe(h,3));const e=new de({color:16777215,transparent:!0,opacity:.15});_=new me(A,e),$.add(_),G.add($)}function Ce(){const e=V.map((t,s)=>ye(t[0],t[1],W[s])),n=xe(e),o=I.map(t=>Pe(Me(n,t)));Z.forEach((t,s)=>{const[i,r]=t,a=o[i],c=o[r];h[s*6+0]=a.x,h[s*6+1]=a.y,h[s*6+2]=a.z,h[s*6+3]=c.x,h[s*6+4]=c.y,h[s*6+5]=c.z}),A.attributes.position.needsUpdate=!0,W=W.map((t,s)=>{let i=t+Ie[s];return i>Math.PI*2?i-=Math.PI*2:i<0&&(i+=Math.PI*2),i})}ve();const ke=document.getElementById("startBtn"),Ee=document.getElementById("resetBtn"),Se=document.getElementById("score"),Be=document.getElementById("highscore"),Ge=document.getElementById("lives");let w=!1,u=0,p=localStorage.getItem("hexgameHighscore")||0,d=3,S={a:0,b:0},l;const y=20;let f=new X;G.add(f);const Le=Math.sqrt(3),q=.5;let B=new Map,M=new Map;const F="crystal",O="coin",Y="bad",k=document.createElement("div");k.style.cssText=`
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, 0.7); color: white; padding: 20px;
    border-radius: 10px; text-align: center; font-family: sans-serif;
    display: none; z-index: 1000;
`;document.body.appendChild(k);function ze(e){k.textContent=e,k.style.display="block",setTimeout(()=>{k.style.display="none"},3e3)}function L(){Se.textContent=u,Be.textContent=p,Ge.textContent=d}function z(e,n,o){const t=o*Le*(e+n/2),s=o*(3/2*n);return[t,s]}function Re(e){if(e<2)return!1;if(e===2)return!0;if(e%2===0)return!1;const n=Math.floor(Math.sqrt(e));for(let o=3;o<=n;o+=2)if(e%o===0)return!1;return!0}function De(e){if(e<2)return 0;let n=0;const o=Math.floor(Math.sqrt(e));for(let t=2;t<=o;t++)e%t===0&&(n++,t!==e/t&&n++);return n}function ee(e,n){if(e===0&&n===0)return!1;const o=e*e-e*n+n*n;return o<=1?!1:Re(o)}function $e(){if(!w){for(w=!0,console.log("Game started!"),u=0,d=3;f.children.length>0;)f.remove(f.children[0]);B.clear(),M.clear(),L(),He(),We(),qe()}}function Ae(){for(w=!1,console.log("Game reset!"),u>p&&(p=u,localStorage.setItem("hexgameHighscore",p)),u=0,d=3;f.children.length>0;)f.remove(f.children[0]);B.clear(),M.clear(),L()}function j(){w=!1,u>p&&(p=u,localStorage.setItem("hexgameHighscore",p)),L(),ze(`Game Over!
Final Score: ${u}
High Score: ${p}`)}function He(){l&&f.remove(l);const e=.5;l=$.clone(),l.scale.set(e,e,e);const n=Math.floor(Math.random()*256)-128,o=Math.floor(Math.random()*256)-128;S={a:n,b:o};const[t,s]=z(n,o,y);l.position.set(t,s,0),f.add(l)}function Te(e,n,o){if(Math.random()<.01){const t=Math.random()<.1?Y:Math.random()<.5?F:O;let s;const[i,r]=z(e,n,y);if(t===F){const a=new he(2),c=new v({color:65535,emissive:65535,emissiveIntensity:.5});s=new C(a,c)}else if(t===O){const a=new K(2,2,.5,32),c=new v({color:16776960,emissive:16776960,emissiveIntensity:.5});s=new C(a,c)}else if(t===Y){const a=new pe(2,.5,16,100),c=new v({color:16711680,emissive:16711680,emissiveIntensity:.5});s=new C(a,c)}s.position.set(i,r,o+5),f.add(s),M.set(`${e},${n}`,{type:t,object:s})}}function We(){for(let n=-128;n<=128;n++)for(let o=-128;o<=128;o++){const t=n*n-n*o+o*o;let s=q,i=5592405,r=!1;if(ee(n,o))s=q*3,i=65280,r=!0;else if(t>1){const D=De(t);s=q/(D+1),i=11184810}if(B.set(`${n},${o}`,{height:s,isPrime:r}),n===0&&o===0)continue;const[a,c]=z(n,o,y),R=new K(y*.9,y*.9,s,6),P=new v({color:i}),g=new C(R,P);g.position.set(a,c,s/2),f.add(g),Te(n,o,s)}}function qe(){const e=new X,n=150,o=1,t=10,s=new ue(o,o,o),i=new v({color:16777215,emissive:16711935,emissiveIntensity:.8});let r=0,a=0,c=1,R=0,P=0;for(let g=1;g<=n*n;g++){if(ee(r,a)){const D=new C(s,i),[ne,oe]=z(r,a,o*2);D.position.set(ne,oe,t),e.add(D)}switch(P){case 0:r++;break;case 1:r++,a--;break;case 2:a--;break;case 3:r--;break;case 4:r--,a++;break;case 5:a++;break}(g===c||g===c+1)&&(R++,P=(P+1)%6,R%2===0&&(c+=1))}e.position.set(0,0,50),f.add(e)}function je(e,n){const o=B.get(`${S.a},${S.b}`),t=B.get(`${e},${n}`);if(!t)return d--,console.log("Fell off the world! Lives remaining:",d),d<=0&&j(),!1;o&&o.isPrime&&t&&!t.isPrime&&(d--,console.log("Fell from a prime pillar! Lives remaining:",d),d<=0&&j());const s=`${e},${n}`;if(M.has(s)){const i=M.get(s);i.type===F?(u+=100,console.log("Collected a crystal!")):i.type===O?(u+=10,console.log("Collected a coin!")):i.type===Y&&(d--,console.log("Collected a bad item! Lives remaining:",d),d<=0&&j()),f.remove(i.object),M.delete(s)}return L(),!0}function m(e){if(!w)return;let{a:n,b:o}=S;const t={a:n,b:o};switch(e){case 0:t.a++;break;case 1:t.a++,t.b--;break;case 2:t.b--;break;case 3:t.a--;break;case 4:t.a--,t.b++;break;case 5:t.b++;break}if(je(t.a,t.b)){S=t;const[s,i]=z(t.a,t.b,y);l.position.x=s,l.position.y=i}}window.addEventListener("keydown",e=>{if(w)switch(e.key.toLowerCase()){case"d":m(0);break;case"q":m(2);break;case"z":m(4);break;case"a":m(3);break;case"e":m(1);break;case"x":m(5);break}});let H,T;const U=50;window.addEventListener("touchstart",e=>{H=e.touches[0].clientX,T=e.touches[0].clientY});window.addEventListener("touchend",e=>{if(!w||!H||!T)return;const n=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY,t=n-H,s=o-T;if(Math.abs(t)>U||Math.abs(s)>U){const i=Math.atan2(s,t);i>-Math.PI/6&&i<=Math.PI/6?m(0):i>Math.PI/6&&i<=Math.PI/2?m(5):i>Math.PI/2&&i<=5*Math.PI/6?m(4):i>5*Math.PI/6||i<=-5*Math.PI/6?m(3):i>-5*Math.PI/6&&i<=-Math.PI/2?m(2):i>-Math.PI/2&&i<=-Math.PI/6&&m(1)}H=null,T=null});ke.addEventListener("click",$e);Ee.addEventListener("click",Ae);L();function Fe(){if(!l)return;const e=new N(l.position.x,l.position.y-15,l.position.z+15);b.position.lerp(e,.05),E.target.copy(l.position),E.update()}function te(){requestAnimationFrame(te),Ce(),w&&l&&(l.rotation.z+=.01,Fe()),x.render(G,b)}te();
//# sourceMappingURL=hexgame2.js.map
