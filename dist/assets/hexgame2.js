import{S as ae,u as se,O as ie,_ as re,g as ce,X as D,P as le,H as de,f as fe,d as ue,L as J,p as k,z as x,b as he,N as K,D as me,I as we}from"./three.module22.js";import{H as pe}from"./OrbitControls22.js";const Q=document.getElementById("bgCanvas");if(!Q)throw new Error("Canvas element with id 'bgCanvas' not found");const v=new ae({canvas:Q,alpha:!0,antialias:!0});v.setSize(window.innerWidth,window.innerHeight);v.setPixelRatio(window.devicePixelRatio);v.setClearColor(0,0);const L=new se,I=new ie(60,window.innerWidth/window.innerHeight,.1,1e3);I.position.set(0,8,15);window.addEventListener("resize",()=>{I.aspect=window.innerWidth/window.innerHeight,I.updateProjectionMatrix(),v.setSize(window.innerWidth,window.innerHeight)});L.add(new re(16777215,.5));const V=new ce(16777215,.8);V.position.set(5,10,7.5);L.add(V);const C=new pe(I,v.domElement);C.enablePan=!1;C.enableZoom=!1;C.target.set(0,0,0);let A;const P=[[1,1,0,0],[1,-1,0,0],[-1,1,0,0],[-1,-1,0,0],[1,0,1,0],[1,0,-1,0],[-1,0,1,0],[-1,0,-1,0],[0,1,1,0],[0,1,-1,0],[0,-1,1,0],[0,-1,-1,0],[1,0,0,1],[1,0,0,-1],[-1,0,0,1],[-1,0,0,-1],[0,1,0,1],[0,1,0,-1],[0,-1,0,1],[0,-1,0,-1],[0,0,1,1],[0,0,1,-1],[0,0,-1,1],[0,0,-1,-1]],O=[];function ge(e,n){return e.reduce((o,t,a)=>o+(t-n[a])**2,0)}for(let e=0;e<P.length;e++)for(let n=e+1;n<P.length;n++)Math.abs(ge(P[e],P[n])-2)<.01&&O.push([e,n]);function be(e,n,o){const t=Array(4).fill(0).map(()=>Array(4).fill(0));for(let a=0;a<4;a++)t[a][a]=1;return t[e][e]=Math.cos(o),t[e][n]=-Math.sin(o),t[n][e]=Math.sin(o),t[n][n]=Math.cos(o),t}function Me(e,n){return e.map((o,t)=>o.reduce((a,s,l)=>a+s*n[l],0))}function ye(e,n){const o=Array(4).fill(0).map(()=>Array(4).fill(0));for(let t=0;t<4;t++)for(let a=0;a<4;a++)for(let s=0;s<4;s++)o[t][a]+=e[t][s]*n[s][a];return o}function Ie(e){return e.reduce((n,o)=>ye(n,o))}function ve(e,n=6){const o=n-e[3],t=o<.1?.1:o;return new K(e[0]*n/t,e[1]*n/t,e[2]*n/t)}const Y=[[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]];let W=Y.map(()=>0),Pe=Y.map(()=>(Math.random()*.001+3e-4)*(Math.random()<.5?1:-1)),m,q,Z;function ke(){A=new D,m=new Float32Array(O.length*2*3),q=new le,q.setAttribute("position",new de(m,3));const e=new fe({color:16777215,transparent:!0,opacity:.15});Z=new ue(q,e),A.add(Z),L.add(A)}function xe(){const e=Y.map((t,a)=>be(t[0],t[1],W[a])),n=Ie(e),o=P.map(t=>ve(Me(n,t)));O.forEach((t,a)=>{const[s,l]=t,i=o[s],r=o[l];m[a*6+0]=i.x,m[a*6+1]=i.y,m[a*6+2]=i.z,m[a*6+3]=r.x,m[a*6+4]=r.y,m[a*6+5]=r.z}),q.attributes.position.needsUpdate=!0,W=W.map((t,a)=>{let s=t+Pe[a];return s>Math.PI*2?s-=Math.PI*2:s<0&&(s+=Math.PI*2),s})}ke();const Ee=document.getElementById("startBtn"),Ce=document.getElementById("resetBtn"),$e=document.getElementById("score"),He=document.getElementById("highscore"),Le=document.getElementById("lives");let p=!1,h=0,w=localStorage.getItem("hexgameHighscore")||0,f=3,$={a:0,b:0},c;const M=20;let d=new D;L.add(d);const ze=Math.sqrt(3),j=.5;let H=new Map,y=new Map;const X="crystal",N="coin",R="bad",E=document.createElement("div");E.style.cssText=`
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, 0.7); color: white; padding: 20px;
    border-radius: 10px; text-align: center; font-family: sans-serif;
    display: none; z-index: 1000;
`;document.body.appendChild(E);function Be(e){E.textContent=e,E.style.display="block",setTimeout(()=>{E.style.display="none"},3e3)}function z(){$e.textContent=h,He.textContent=w,Le.textContent=f}function B(e,n,o){const t=o*ze*(e+n/2),a=o*(3/2*n);return[t,a]}function Se(e){if(e<2)return!1;if(e===2)return!0;if(e%2===0)return!1;const n=Math.floor(Math.sqrt(e));for(let o=3;o<=n;o+=2)if(e%o===0)return!1;return!0}function Ae(e){if(e<2)return 0;let n=0;const o=Math.floor(Math.sqrt(e));for(let t=2;t<=o;t++)e%t===0&&(n++,t!==e/t&&n++);return n}function ee(e,n){if(e===0&&n===0)return!1;const o=e*e-e*n+n*n;return o<=1?!1:Se(o)}function qe(){if(!p){for(p=!0,console.log("Game started!"),h=0,f=3;d.children.length>0;)d.remove(d.children[0]);H.clear(),y.clear(),z(),Te(),je(),Ge()}}function Fe(){for(p=!1,console.log("Game reset!"),h>w&&(w=h,localStorage.setItem("hexgameHighscore",w)),h=0,f=3;d.children.length>0;)d.remove(d.children[0]);H.clear(),y.clear(),z()}function G(){p=!1,h>w&&(w=h,localStorage.setItem("hexgameHighscore",w)),z(),Be(`Game Over!
Final Score: ${h}
High Score: ${w}`)}function Te(){c&&d.remove(c);const e=.5;c=A.clone(),c.scale.set(e,e,e);const n=Math.floor(Math.random()*256)-128,o=Math.floor(Math.random()*256)-128;$={a:n,b:o};const[t,a]=B(n,o,M);c.position.set(t,a,0),d.add(c)}function We(e,n,o){if(Math.random()<.01){const t=Math.random()<.1?R:Math.random()<.5?X:N;let a;const[s,l]=B(e,n,M);if(t===X){const i=new me(2),r=new k({color:65535,emissive:65535,emissiveIntensity:.5});a=new x(i,r)}else if(t===N){const i=new J(2,2,.5,32),r=new k({color:16776960,emissive:16776960,emissiveIntensity:.5});a=new x(i,r)}else if(t===R){const i=new we(2,.5,16,100),r=new k({color:16711680,emissive:16711680,emissiveIntensity:.5});a=new x(i,r)}a.position.set(s,l,o+5),d.add(a),y.set(`${e},${n}`,{type:t,object:a})}}function je(){for(let e=-128;e<=128;e++)for(let n=-128;n<=128;n++){const o=e*e-e*n+n*n;let t=j,a=5592405,s=!1;if(ee(e,n))t=j*3,a=65280,s=!0;else if(o>1){const b=Ae(o);t=j/(b+1),a=11184810}if(H.set(`${e},${n}`,{height:t,isPrime:s}),e===0&&n===0)continue;const[l,i]=B(e,n,M),r=new J(M*.9,M*.9,t,6),S=new k({color:a}),g=new x(r,S);g.position.set(l,i,t/2),d.add(g),We(e,n,t)}}function Ge(){const e=new D,n=150,o=1,t=10,a=new he(o,o,o),s=new k({color:16777215,emissive:16711935,emissiveIntensity:.8});let l=0,i=0,r=1,S=0,g=0;for(let b=1;b<=n*n;b++){if(ee(l,i)){const U=new x(a,s),[ne,oe]=B(l,i,o*2);U.position.set(ne,oe,t),e.add(U)}switch(g){case 0:l++;break;case 1:l++,i--;break;case 2:i--;break;case 3:l--;break;case 4:l--,i++;break;case 5:i++;break}(b===r||b===r+1)&&(S++,g=(g+1)%6,S%2===0&&(r+=1))}e.position.set(0,0,50),d.add(e)}function Xe(e,n){const o=H.get(`${$.a},${$.b}`),t=H.get(`${e},${n}`);if(!t)return f--,console.log("Fell off the world! Lives remaining:",f),f<=0&&G(),!1;o&&o.isPrime&&t&&!t.isPrime&&(f--,console.log("Fell from a prime pillar! Lives remaining:",f),f<=0&&G());const a=`${e},${n}`;if(y.has(a)){const s=y.get(a);s.type===X?(h+=100,console.log("Collected a crystal!")):s.type===N?(h+=10,console.log("Collected a coin!")):s.type===R&&(f--,console.log("Collected a bad item! Lives remaining:",f),f<=0&&G()),d.remove(s.object),y.delete(a)}return z(),!0}function u(e){if(!p)return;let{a:n,b:o}=$;const t={a:n,b:o};switch(e){case 0:t.a++;break;case 1:t.a++,t.b--;break;case 2:t.b--;break;case 3:t.a--;break;case 4:t.a--,t.b++;break;case 5:t.b++;break}if(Xe(t.a,t.b)){$=t;const[a,s]=B(t.a,t.b,M);c.position.x=a,c.position.y=s}}window.addEventListener("keydown",e=>{if(p)switch(e.key.toLowerCase()){case"d":u(0);break;case"q":u(2);break;case"z":u(4);break;case"a":u(3);break;case"e":u(1);break;case"x":u(5);break}});let F,T;const _=50;window.addEventListener("touchstart",e=>{F=e.touches[0].clientX,T=e.touches[0].clientY});window.addEventListener("touchend",e=>{if(!p||!F||!T)return;const n=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY,t=n-F,a=o-T;if(Math.abs(t)>_||Math.abs(a)>_){const s=Math.atan2(a,t);s>-Math.PI/6&&s<=Math.PI/6?u(0):s>Math.PI/6&&s<=Math.PI/2?u(5):s>Math.PI/2&&s<=5*Math.PI/6?u(4):s>5*Math.PI/6||s<=-5*Math.PI/6?u(3):s>-5*Math.PI/6&&s<=-Math.PI/2?u(2):s>-Math.PI/2&&s<=-Math.PI/6&&u(1)}F=null,T=null});Ee.addEventListener("click",qe);Ce.addEventListener("click",Fe);z();function Ne(){if(!c)return;const e=new K(c.position.x,c.position.y-15,c.position.z+15);I.position.lerp(e,.05),C.target.copy(c.position),C.update()}function te(){requestAnimationFrame(te),xe(),p&&c&&(c.rotation.z+=.01,Ne()),v.render(L,I)}te();
//# sourceMappingURL=hexgame2.js.map
