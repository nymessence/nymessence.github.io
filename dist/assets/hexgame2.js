import{z as ae,R as ie,O as se,N as re,a as ce,Z as U,U as le,V as de,L as he,P as fe,b as J,D as k,H as x,C as ue,c as me,d as we,I as Q}from"./three.module2.js";import{X as pe}from"./OrbitControls2.js";const _=document.getElementById("bgCanvas");if(!_)throw new Error("Canvas element with id 'bgCanvas' not found");const v=new ae({canvas:_,alpha:!0,antialias:!0});v.setSize(window.innerWidth,window.innerHeight);v.setPixelRatio(window.devicePixelRatio);v.setClearColor(0,0);const z=new ie,I=new se(60,window.innerWidth/window.innerHeight,.1,1e3);I.position.set(0,8,15);window.addEventListener("resize",()=>{I.aspect=window.innerWidth/window.innerHeight,I.updateProjectionMatrix(),v.setSize(window.innerWidth,window.innerHeight)});z.add(new re(16777215,.5));const K=new ce(16777215,.8);K.position.set(5,10,7.5);z.add(K);const C=new pe(I,v.domElement);C.enablePan=!1;C.enableZoom=!1;C.target.set(0,0,0);let S;const P=[[1,1,0,0],[1,-1,0,0],[-1,1,0,0],[-1,-1,0,0],[1,0,1,0],[1,0,-1,0],[-1,0,1,0],[-1,0,-1,0],[0,1,1,0],[0,1,-1,0],[0,-1,1,0],[0,-1,-1,0],[1,0,0,1],[1,0,0,-1],[-1,0,0,1],[-1,0,0,-1],[0,1,0,1],[0,1,0,-1],[0,-1,0,1],[0,-1,0,-1],[0,0,1,1],[0,0,1,-1],[0,0,-1,1],[0,0,-1,-1]],Z=[];function ge(e,n){return e.reduce((o,t,a)=>o+(t-n[a])**2,0)}for(let e=0;e<P.length;e++)for(let n=e+1;n<P.length;n++)Math.abs(ge(P[e],P[n])-2)<.01&&Z.push([e,n]);function be(e,n,o){const t=Array(4).fill(0).map(()=>Array(4).fill(0));for(let a=0;a<4;a++)t[a][a]=1;return t[e][e]=Math.cos(o),t[e][n]=-Math.sin(o),t[n][e]=Math.sin(o),t[n][n]=Math.cos(o),t}function Me(e,n){return e.map((o,t)=>o.reduce((a,i,l)=>a+i*n[l],0))}function ye(e,n){const o=Array(4).fill(0).map(()=>Array(4).fill(0));for(let t=0;t<4;t++)for(let a=0;a<4;a++)for(let i=0;i<4;i++)o[t][a]+=e[t][i]*n[i][a];return o}function Ie(e){return e.reduce((n,o)=>ye(n,o))}function ve(e,n=6){const o=n-e[3],t=o<.1?.1:o;return new Q(e[0]*n/t,e[1]*n/t,e[2]*n/t)}const N=[[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]];let T=N.map(()=>0),Pe=N.map(()=>(Math.random()*.001+3e-4)*(Math.random()<.5?1:-1)),m,q,X;function ke(){S=new U,m=new Float32Array(Z.length*2*3),q=new le,q.setAttribute("position",new de(m,3));const e=new he({color:16777215,transparent:!0,opacity:.15});X=new fe(q,e),S.add(X),z.add(S)}function xe(){const e=N.map((t,a)=>be(t[0],t[1],T[a])),n=Ie(e),o=P.map(t=>ve(Me(n,t)));Z.forEach((t,a)=>{const[i,l]=t,s=o[i],r=o[l];m[a*6+0]=s.x,m[a*6+1]=s.y,m[a*6+2]=s.z,m[a*6+3]=r.x,m[a*6+4]=r.y,m[a*6+5]=r.z}),q.attributes.position.needsUpdate=!0,T=T.map((t,a)=>{let i=t+Pe[a];return i>Math.PI*2?i-=Math.PI*2:i<0&&(i+=Math.PI*2),i})}ke();const Ee=document.getElementById("startBtn"),Ce=document.getElementById("resetBtn"),$e=document.getElementById("score"),Le=document.getElementById("highscore"),ze=document.getElementById("lives");let p=!1,u=0,w=localStorage.getItem("hexgameHighscore")||0,h=3,$={a:0,b:0},c;const M=20;let d=new U;z.add(d);const He=Math.sqrt(3),W=.5;let L=new Map,y=new Map;const D="crystal",G="coin",O="bad",E=document.createElement("div");E.style.cssText=`
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, 0.7); color: white; padding: 20px;
    border-radius: 10px; text-align: center; font-family: sans-serif;
    display: none; z-index: 1000;
`;document.body.appendChild(E);function Be(e){E.textContent=e,E.style.display="block",setTimeout(()=>{E.style.display="none"},3e3)}function H(){$e.textContent=u,Le.textContent=w,ze.textContent=h}function B(e,n,o){const t=o*He*(e+n/2),a=o*(3/2*n);return[t,a]}function Ae(e){if(e<2)return!1;if(e===2)return!0;if(e%2===0)return!1;const n=Math.floor(Math.sqrt(e));for(let o=3;o<=n;o+=2)if(e%o===0)return!1;return!0}function Se(e){if(e<2)return 0;let n=0;const o=Math.floor(Math.sqrt(e));for(let t=2;t<=o;t++)e%t===0&&(n++,t!==e/t&&n++);return n}function ee(e,n){if(e===0&&n===0)return!1;const o=e*e-e*n+n*n;return o<=1?!1:Ae(o)}function qe(){if(!p){for(p=!0,console.log("Game started!"),u=0,h=3;d.children.length>0;)d.remove(d.children[0]);L.clear(),y.clear(),H(),Re(),We(),je()}}function Fe(){for(p=!1,console.log("Game reset!"),u>w&&(w=u,localStorage.setItem("hexgameHighscore",w)),u=0,h=3;d.children.length>0;)d.remove(d.children[0]);L.clear(),y.clear(),H()}function j(){p=!1,u>w&&(w=u,localStorage.setItem("hexgameHighscore",w)),H(),Be(`Game Over!
Final Score: ${u}
High Score: ${w}`)}function Re(){c&&d.remove(c);const e=.5;c=S.clone(),c.scale.set(e,e,e);const n=Math.floor(Math.random()*256)-128,o=Math.floor(Math.random()*256)-128;$={a:n,b:o};const[t,a]=B(n,o,M);c.position.set(t,a,0),d.add(c)}function Te(e,n,o){if(Math.random()<.01){const t=Math.random()<.1?O:Math.random()<.5?D:G;let a;const[i,l]=B(e,n,M);if(t===D){const s=new me(2),r=new k({color:65535,emissive:65535,emissiveIntensity:.5});a=new x(s,r)}else if(t===G){const s=new J(2,2,.5,32),r=new k({color:16776960,emissive:16776960,emissiveIntensity:.5});a=new x(s,r)}else if(t===O){const s=new we(2,.5,16,100),r=new k({color:16711680,emissive:16711680,emissiveIntensity:.5});a=new x(s,r)}a.position.set(i,l,o+5),d.add(a),y.set(`${e},${n}`,{type:t,object:a})}}function We(){for(let e=-128;e<=128;e++)for(let n=-128;n<=128;n++){const o=e*e-e*n+n*n;let t=W,a=5592405,i=!1;if(ee(e,n))t=W*3,a=65280,i=!0;else if(o>1){const b=Se(o);t=W/(b+1),a=11184810}if(L.set(`${e},${n}`,{height:t,isPrime:i}),e===0&&n===0)continue;const[l,s]=B(e,n,M),r=new J(M*.9,M*.9,t,6),A=new k({color:a}),g=new x(r,A);g.position.set(l,s,t/2),d.add(g),Te(e,n,t)}}function je(){const e=new U,n=150,o=1,t=10,a=new ue(o,o,o),i=new k({color:16777215,emissive:16711935,emissiveIntensity:.8});let l=0,s=0,r=1,A=0,g=0;for(let b=1;b<=n*n;b++){if(ee(l,s)){const V=new x(a,i),[ne,oe]=B(l,s,o*2);V.position.set(ne,oe,t),e.add(V)}switch(g){case 0:l++;break;case 1:l++,s--;break;case 2:s--;break;case 3:l--;break;case 4:l--,s++;break;case 5:s++;break}(b===r||b===r+1)&&(A++,g=(g+1)%6,A%2===0&&(r+=1))}e.position.set(0,0,50),d.add(e)}function De(e,n){const o=L.get(`${$.a},${$.b}`),t=L.get(`${e},${n}`);if(!t)return h--,console.log("Fell off the world! Lives remaining:",h),h<=0&&j(),!1;o&&o.isPrime&&t&&!t.isPrime&&(h--,console.log("Fell from a prime pillar! Lives remaining:",h),h<=0&&j());const a=`${e},${n}`;if(y.has(a)){const i=y.get(a);i.type===D?(u+=100,console.log("Collected a crystal!")):i.type===G?(u+=10,console.log("Collected a coin!")):i.type===O&&(h--,console.log("Collected a bad item! Lives remaining:",h),h<=0&&j()),d.remove(i.object),y.delete(a)}return H(),!0}function f(e){if(!p)return;let{a:n,b:o}=$;const t={a:n,b:o};switch(e){case 0:t.a++;break;case 1:t.a++,t.b--;break;case 2:t.b--;break;case 3:t.a--;break;case 4:t.a--,t.b++;break;case 5:t.b++;break}if(De(t.a,t.b)){$=t;const[a,i]=B(t.a,t.b,M);c.position.x=a,c.position.y=i}}window.addEventListener("keydown",e=>{if(p)switch(e.key.toLowerCase()){case"d":f(0);break;case"q":f(2);break;case"z":f(4);break;case"a":f(3);break;case"e":f(1);break;case"x":f(5);break}});let F,R;const Y=50;window.addEventListener("touchstart",e=>{F=e.touches[0].clientX,R=e.touches[0].clientY});window.addEventListener("touchend",e=>{if(!p||!F||!R)return;const n=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY,t=n-F,a=o-R;if(Math.abs(t)>Y||Math.abs(a)>Y){const i=Math.atan2(a,t);i>-Math.PI/6&&i<=Math.PI/6?f(0):i>Math.PI/6&&i<=Math.PI/2?f(5):i>Math.PI/2&&i<=5*Math.PI/6?f(4):i>5*Math.PI/6||i<=-5*Math.PI/6?f(3):i>-5*Math.PI/6&&i<=-Math.PI/2?f(2):i>-Math.PI/2&&i<=-Math.PI/6&&f(1)}F=null,R=null});Ee.addEventListener("click",qe);Ce.addEventListener("click",Fe);H();function Ge(){if(!c)return;const e=new Q(c.position.x,c.position.y-15,c.position.z+15);I.position.lerp(e,.05),C.target.copy(c.position),C.update()}function te(){requestAnimationFrame(te),xe(),p&&c&&(c.rotation.z+=.01,Ge()),v.render(z,I)}te();
//# sourceMappingURL=hexgame2.js.map
