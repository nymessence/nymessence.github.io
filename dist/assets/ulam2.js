const Y=document.getElementById("ulamCanvas"),a=Y.getContext("2d"),q=document.getElementById("modeSelect");let X=0,L=0,T=20,u=1,$=0,g=0;const h=window.devicePixelRatio||1;let x=0,b=0;const rt=.92;let C=!1,j=0,A=0,H=0,I=0,Q=-1,O=1;const k=new Map,d=document.createElement("div");d.style.position="fixed";d.style.background="rgba(0,0,0,0.85)";d.style.color="#0f0";d.style.padding="6px 10px";d.style.borderRadius="5px";d.style.fontFamily="monospace";d.style.fontSize="13px";d.style.pointerEvents="none";d.style.whiteSpace="pre";d.style.display="none";d.style.zIndex=1e4;document.body.appendChild(d);const R=new Map;function P(t){if(t<2)return!1;if(R.has(t))return R.get(t);if(t===2)return R.set(t,!0),!0;if(t%2===0)return R.set(t,!1),!1;const n=Math.floor(Math.sqrt(t));for(let e=3;e<=n;e+=2)if(t%e===0)return R.set(t,!1),!1;return R.set(t,!0),!0}function F(t){if(t<2)return 0;let n=0;const e=Math.floor(Math.sqrt(t));for(let o=2;o<=e;o++)t%o===0&&(n++,o!==t/o&&n++);return n}function J(t){const n=new Map;let e=t;for(let o=2;o*o<=e;o++)for(;e%o===0;)n.set(o,(n.get(o)||0)+1),e=Math.floor(e/o);return e>1&&n.set(e,(n.get(e)||0)+1),n}function U(t){if(!t||t.size===0)return"(none)";const n=[];for(const[e,o]of t.entries())n.push(o>1?`${e}^${o}`:`${e}`);return n.join(" × ")}function at(t){if(t<=2||t%2!==0)return 0;let n=0;for(let e=2;e<=t/2;e++)P(e)&&P(t-e)&&n++;return n}const yt=.6601618158;function pt(t){if(t<=2||t%2!==0)return 1;const n=Math.log(t);if(n===0)return 1;let e=1;const o=J(t);for(const[s]of o.entries())s>2&&(e*=(s-1)/(s-2));return 2*yt*(t/(n*n))*e}function V(t,n){if(t===0&&n===0)return 1;const e=Math.max(Math.abs(t),Math.abs(n)),o=2*e,s=(2*e+1)**2;let r;return n===e?r=s-(e-t):t===-e?r=s-o-(e-n):n===-e?r=s-2*o-(t+e):r=s-3*o-(n+e),r}function Z(t,n){const e=Math.abs(t),o=Math.abs(n);return e===0&&o===0?!1:e===0?P(o)&&o%4===3:o===0?P(e)&&e%4===3:P(e*e+o*o)}function _(t,n){if(t===0&&n===0)return!1;const e=t*t-t*n+n*n;return e<=1?!1:P(e)}const tt=Math.sqrt(3);function K(t,n,e){const o=e*tt*(t+n/2),s=e*(3/2*n);return[o,s]}function D(t,n,e){const o=.6666666666666666*n/e,s=t/(e*tt)-o/2,r=o,l=-s-r;let i=Math.round(s),c=Math.round(l),f=Math.round(r);const m=Math.abs(i-s),y=Math.abs(c-l),M=Math.abs(f-r);return m>y&&m>M?i=-c-f:y>M?c=-i-f:f=-i-c,[i,f]}function lt(t,n,e,o,s,r,l){t.beginPath();for(let i=0;i<6;i++){const c=Math.PI/6+i*Math.PI/3,f=o*Math.cos(c),m=o*Math.sin(c);i===0?t.moveTo(n+f,e+m):t.lineTo(n+f,e+m)}t.closePath(),s&&(t.fillStyle=s,t.fill()),r&&(t.strokeStyle=r,t.lineWidth=l,t.stroke())}function ct(t,n){const e=q.value.toLowerCase();if(e.includes("-comet")){let o;if(e.startsWith("ulam-")?o=V(t,n):e.startsWith("gauss-")?o=t*t+n*n:o=t*t-t*n+n*n,o<=2||o%2!==0)return"rgba(20, 20, 20, 1)";const s=at(o),r=Math.log(o),l=240-s/(o/r**2)*120;return`hsl(${Math.max(0,Math.min(240,l))}, 90%, 55%)`}if(e.includes("ulam-")){const o=V(t,n);if(e==="ulam-green")return P(o)?"#00ff00":"transparent";if(o===1)return"black";if(P(o))return"#ffffff";const s=F(o);let r=Math.max(0,255-s*12);return r=Math.min(255,r),`rgb(${r},${Math.floor(r/2)},0)`}else if(e.includes("gauss-")){const o=t,s=n,r=o*o+s*s;if(e==="gauss-green")return Z(o,s)?"#00ff00":"transparent";{if(Z(o,s))return"#ffffff";if(r<=1)return"black";const l=F(r);let i=Math.max(0,255-l*12);return i=Math.min(255,i),`rgb(${i},${Math.floor(i/2)},0)`}}else if(e.includes("eisen")){const o=t,s=n,r=o*o-o*s+s*s;if(e.includes("eisen-green"))return _(o,s)?"#00ff00":"transparent";{if(_(o,s))return"#ffffff";if(r<=1)return"black";const l=F(r);let i=Math.max(0,255-l*12);return i=Math.min(255,i),`rgb(${i},${Math.floor(i/2)},0)`}}return"transparent"}const E=5,ut=.05,ft=12;function S(){k.clear();const t=q.value,n=t.toLowerCase().includes("eisen"),e=-$/u,o=(X-$)/u,s=-g/u,r=(L-g)/u;if(n){const l=T,i=l*tt,c=l*2,[f,m]=D(e,s,l),[y,M]=D(o,s,l),[p,B]=D(e,r,l),[z,W]=D(o,r,l),G=Math.min(f,y,p,z)-E,mt=Math.max(f,y,p,z)+E,Mt=Math.min(m,M,B,W)-E,$t=Math.max(m,M,B,W)+E;for(let v=Math.floor(Mt);v<=Math.ceil($t);v++)for(let w=Math.floor(G);w<=Math.ceil(mt);w++){const[et,nt]=K(w,v,l);if(et>e-i&&et<o+i&&nt>s-c&&nt<r+c){const gt=`${w},${v}`;let ot,st,it;st=w*w-w*v+v*v,ot=`${w}${v>=0?"+":""}${v}ω`,it=ct(w,v),k.set(gt,{x:w,y:v,label:ot,value:st,color:it})}}}else{const l=T,i=l,c=Math.floor(e/l)-E,f=Math.ceil(o/l)+E,m=Math.floor(s/i)-E,y=Math.ceil(r/i)+E;for(let M=m;M<=y;M++)for(let p=c;p<=f;p++){const B=`${p},${M}`;let z,W,G;t.toLowerCase().includes("ulam-")?(W=V(p,M),z=String(W)):(W=p*p+M*M,z=`${p}${M>=0?"+":""}${M}i`),G=ct(p,M),k.set(B,{x:p,y:M,label:z,value:W,color:G})}}}function N(){a.clearRect(0,0,X*h,L*h),a.save(),a.translate($,g),a.scale(u,u);const t=q.value.toLowerCase();if(t.includes("gauss-"))a.strokeStyle="#666",a.lineWidth=1/u,a.beginPath(),a.moveTo(-X/u,0),a.lineTo(X/u,0),a.moveTo(0,-L/u),a.lineTo(0,L/u),a.stroke();else if(t.includes("eisen")){a.strokeStyle="#666",a.lineWidth=1/u,a.beginPath();const n=Math.max(X,L)/u,[e,o]=K(n,0,1);a.moveTo(-e,-o),a.lineTo(e,o);const[s,r]=K(0,n,1);a.moveTo(-s,-r),a.lineTo(s,r),a.stroke()}if(t.includes("eisen")){const n=T;for(const e of k.values()){const[o,s]=K(e.x,e.y,n);e.color!=="transparent"&&lt(a,o,s,n,e.color,null,null),lt(a,o,s,n,null,"rgba(0,0,0,0.2)",1/u)}}else{const n=T;for(const e of k.values())e.color!=="transparent"&&(a.fillStyle=e.color,a.fillRect(e.x*n,e.y*n,n,n),a.strokeStyle="rgba(0,0,0,0.2)",a.lineWidth=1/u,a.strokeRect(e.x*n,e.y*n,n,n))}a.restore()}function ht(){C||(Math.abs(x)>.1||Math.abs(b)>.1?($+=x,g+=b,x*=rt,b*=rt,S(),N()):Math.abs(x)<=.1&&Math.abs(b)<=.1&&(x!==0||b!==0)&&(x=0,b=0)),requestAnimationFrame(ht)}function vt(t,n){const e=q.value,o=(t/h-$)/u,s=(n/h-g)/u;if(e.toLowerCase().includes("eisen")){const[r,l]=D(o,s,T),i=`${r},${l}`;return k.get(i)}else{const r=Math.floor(o/T),l=Math.floor(s/T);return k.get(`${r},${l}`)}}function wt(t){if(C){d.style.display="none";const i=t.clientX-j,c=t.clientY-A;$=H+i*h,g=I+c*h,x=t.movementX*h,b=t.movementY*h,S(),N();return}const n=vt(t.clientX*h,t.clientY*h);if(!n){d.style.display="none";return}const e=q.value;let o="";if(e.toLowerCase().includes("-comet")){const i=n.value;let c=`n = ${i}`;if(e.startsWith("gauss-")?c=`${n.x}${n.y>=0?"+":""}${n.y}i
Norm = ${i}`:e.startsWith("eisen-")&&(c=`${n.x}${n.y>=0?"+":""}${n.y}ω
Norm = ${i}`),i<=2||i%2!==0)o=`${c}
(Odd or too small)`;else{const f=at(i),m=pt(i),y=m>.1?f/m:0;o=`${c}
Goldbach Pairs: ${f}
Heuristic: ${m.toFixed(2)}
Ratio: ${y.toFixed(2)}`}}else if(e.toLowerCase().includes("ulam-")){const i=n.value,c=F(i),f=U(J(i));o=`n = ${i}
Factors (excluding 1,n): ${c}
Prime factorization:
${f}`}else if(e.toLowerCase().includes("gauss-")){const i=n.x,c=n.y,f=n.value,m=Z(i,c)?"Yes":"No",y=F(f),M=U(J(f));o=`${i}${c>=0?"+":""}${c}i
Gaussian prime: ${m}
Norm = ${f}
Norm factors (excl 1,norm): ${y}
Prime factorization of norm:
${M}`}else if(e.toLowerCase().includes("eisen")){const i=n.x,c=n.y,f=n.value,m=_(i,c)?"Yes":"No",y=F(f),M=U(J(f));o=`${i}${c>=0?"+":""}${c}ω
Eisenstein prime: ${m}
Norm = ${f}
Norm factors (excl 1,norm): ${y}
Prime factorization of norm:
${M}`}d.textContent=o,d.style.display="block";const s=12;let r=t.clientX+s,l=t.clientY+s;r+d.offsetWidth>window.innerWidth&&(r=t.clientX-d.offsetWidth-s),l+d.offsetHeight>window.innerHeight&&(l=t.clientY-d.offsetHeight-s),d.style.left=`${r}px`,d.style.top=`${l}px`}function xt(t){t.preventDefault();const n=t.clientX*h,e=t.clientY*h,o=-t.deltaY*.001;let s=u*(1+o);s=Math.min(Math.max(s,ut),ft);const r=(n-$)/u,l=(e-g)/u;$-=r*s-r*u,g-=l*s-l*u,u=s,S(),N()}function bt(t){C=!0,j=t.clientX,A=t.clientY,H=$,I=g,x=0,b=0,Y.style.cursor="grabbing",d.style.display="none"}function Yt(){C=!1,Y.style.cursor="grab"}function Xt(t){if(t.preventDefault(),t.touches.length===2){const n=t.touches[0],e=t.touches[1];Q=Math.hypot(e.clientX-n.clientX,e.clientY-n.clientY),O=u,C=!1,d.style.display="none"}else t.touches.length===1&&(C=!0,j=t.touches[0].clientX,A=t.touches[0].clientY,H=$,I=g,x=0,b=0,d.style.display="none")}function Lt(t){if(t.preventDefault(),t.touches.length===2&&Q>0){const n=t.touches[0],e=t.touches[1],o=Math.hypot(e.clientX-n.clientX,e.clientY-n.clientY),s=O*(o/Q);u=Math.min(Math.max(s,ut),ft);const r=(n.clientX+e.clientX)/2,l=(n.clientY+e.clientY)/2,i=(r*h-H)/O,c=(l*h-I)/O,f=(r*h-$)/u,m=(l*h-g)/u;$+=(f-i)*u,g+=(m-c)*u,S(),N()}else if(C&&t.touches.length===1){const n=t.touches[0].clientX-j,e=t.touches[0].clientY-A;$=H+n*h,g=I+e*h,t.touches[0].previousClientX!==void 0&&(x=(t.touches[0].clientX-t.touches[0].previousClientX)*h,b=(t.touches[0].clientY-t.touches[0].previousClientY)*h),S(),N()}}function Ct(t){Q=-1,t.touches.length===0?C=!1:t.touches.length===1&&(C=!0,j=t.touches[0].clientX,A=t.touches[0].clientY,H=$,I=g)}function dt(){X=window.innerWidth,L=window.innerHeight,Y.style.width=`${X}px`,Y.style.height=`${L}px`,Y.width=X*h,Y.height=L*h,a.setTransform(h,0,0,h,0,0),$===0&&g===0&&($=X*h/2,g=L*h/2),S(),N()}q.addEventListener("change",()=>{k.clear(),S(),N()});Y.addEventListener("wheel",xt,{passive:!1});Y.addEventListener("mousedown",bt);window.addEventListener("mousemove",wt);window.addEventListener("mouseup",Yt);Y.addEventListener("touchstart",Xt,{passive:!1});window.addEventListener("touchmove",Lt,{passive:!1});window.addEventListener("touchend",Ct);window.addEventListener("resize",dt);dt();ht();
//# sourceMappingURL=ulam2.js.map
