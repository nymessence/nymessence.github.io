const C=document.getElementById("ulamCanvas"),a=C.getContext("2d"),A=document.getElementById("modeSelect");let Y=0,X=0,k=20,f=1,p=0,g=0;const h=window.devicePixelRatio||1;let b=0,x=0;const lt=.92;let L=!1,I=0,q=0,N=0,R=0,O=-1,U=1;const T=new Map,d=document.createElement("div");d.style.position="fixed";d.style.background="rgba(0,0,0,0.85)";d.style.color="#0f0";d.style.padding="6px 10px";d.style.borderRadius="5px";d.style.fontFamily="monospace";d.style.fontSize="13px";d.style.pointerEvents="none";d.style.whiteSpace="pre";d.style.display="none";d.style.zIndex=1e4;document.body.appendChild(d);const F=new Map;function W(t){if(t<2)return!1;if(F.has(t))return F.get(t);if(t===2)return F.set(t,!0),!0;if(t%2===0)return F.set(t,!1),!1;const n=Math.floor(Math.sqrt(t));for(let e=3;e<=n;e+=2)if(t%e===0)return F.set(t,!1),!1;return F.set(t,!0),!0}function H(t){if(t<2)return 0;let n=0;const e=Math.floor(Math.sqrt(t));for(let o=2;o<=e;o++)t%o===0&&(n++,o!==t/o&&n++);return n}function V(t){const n=new Map;let e=t;for(let o=2;o*o<=e;o++)for(;e%o===0;)n.set(o,(n.get(o)||0)+1),e=Math.floor(e/o);return e>1&&n.set(e,(n.get(e)||0)+1),n}function J(t){if(!t||t.size===0)return"(none)";const n=[];for(const[e,o]of t.entries())n.push(o>1?`${e}^${o}`:`${e}`);return n.join(" × ")}function at(t){if(t<=2||t%2!==0)return 0;let n=0;for(let e=2;e<=t/2;e++)W(e)&&W(t-e)&&n++;return n}const vt=.6601618158;function yt(t){if(t<=2||t%2!==0)return 1;const n=Math.log(t);if(n===0)return 1;let e=1;const o=V(t);for(const[i]of o.entries())i>2&&(e*=(i-1)/(i-2));return 2*vt*(t/(n*n))*e}function K(t,n){if(t===0&&n===0)return 1;const e=Math.max(Math.abs(t),Math.abs(n)),o=2*e,s=(2*e+1)**2;let i;return n===e?i=s-(e-t):t===-e?i=s-o-(e-n):n===-e?i=s-2*o-(t+e):i=s-3*o-(n+e),i}function Q(t,n){const e=Math.abs(t),o=Math.abs(n);return e===0&&o===0?!1:e===0?W(o)&&o%4===3:o===0?W(e)&&e%4===3:W(e*e+o*o)}function Z(t,n){if(t===0&&n===0)return!1;const e=t*t-t*n+n*n;return e<=1?!1:W(e)}const tt=Math.sqrt(3);function j(t,n,e){const o=e*tt*(t+n/2),s=e*(3/2*n);return[o,s]}function D(t,n,e){const o=.6666666666666666*n/e,i=t/(e*tt)-o/2,l=o,r=-i-l;let c=Math.round(i),u=Math.round(r),m=Math.round(l);const y=Math.abs(c-i),M=Math.abs(u-r),v=Math.abs(m-l);return y>M&&y>v?c=-u-m:M>v?u=-c-m:m=-c-u,[c,m]}function ct(t,n,e,o,s,i,l){t.beginPath();for(let r=0;r<6;r++){const c=Math.PI/6+r*Math.PI/3,u=o*Math.cos(c),m=o*Math.sin(c);r===0?t.moveTo(n+u,e+m):t.lineTo(n+u,e+m)}t.closePath(),s&&(t.fillStyle=s,t.fill()),i&&(t.strokeStyle=i,t.lineWidth=l,t.stroke())}function rt(t,n){const o=A.value.toLowerCase();if(o.includes("-comet")){let s;if(o.startsWith("ulam-")?s=K(t,n):o.startsWith("gauss-")?s=t*t+n*n:s=t*t-t*n+n*n,s<=2||s%2!==0)return"rgba(20, 20, 20, 1)";const i=at(s),l=Math.log(s),c=240-i/(s/l**2)*120;return`hsl(${Math.max(0,Math.min(240,c))}, 90%, 55%)`}if(o.includes("ulam-")){const s=K(t,n);if(o==="ulam-green")return W(s)?"#00ff00":"transparent";if(s===1)return"black";if(W(s))return"#ffffff";const i=H(s);let l=Math.max(0,255-i*12);return l=Math.min(255,l),`rgb(${l},${Math.floor(l/2)},0)`}else if(o.includes("gauss-")){const s=t,i=n,l=s*s+i*i;if(o==="gauss-green")return Q(s,i)?"#00ff00":"transparent";{if(Q(s,i))return"#ffffff";if(l<=1)return"black";const r=H(l);let c=Math.max(0,255-r*12);return c=Math.min(255,c),`rgb(${c},${Math.floor(c/2)},0)`}}else if(o.includes("eisen")){const s=t,i=n,l=s*s-s*i+i*i;if(o.includes("eisen-green"))return Z(s,i)?"#00ff00":"transparent";{if(Z(s,i))return"#ffffff";if(l<=1)return"black";const r=H(l);let c=Math.max(0,255-r*12);return c=Math.min(255,c),`rgb(${c},${Math.floor(c/2)},0)`}}return"transparent"}const E=5,ft=.05,ut=12;function P(){T.clear();const t=A.value,n=t.toLowerCase().includes("eisen"),e=-p/f,o=(Y-p)/f,s=-g/f,i=(X-g)/f;if(n){const l=k,r=l*tt,c=l*2,[u,m]=D(e,s,l),[y,M]=D(o,s,l),[v,B]=D(e,i,l),[z,S]=D(o,i,l),G=Math.min(u,y,v,z)-E,mt=Math.max(u,y,v,z)+E,Mt=Math.min(m,M,B,S)-E,pt=Math.max(m,M,B,S)+E;for(let $=Math.floor(Mt);$<=Math.ceil(pt);$++)for(let w=Math.floor(G);w<=Math.ceil(mt);w++){const[et,nt]=j(w,$,l);if(et>e-r&&et<o+r&&nt>s-c&&nt<i+c){const gt=`${w},${$}`;let ot,st,it;st=w*w-w*$+$*$,ot=`${w}${$>=0?"+":""}${$}ω`,it=rt(w,$),T.set(gt,{x:w,y:$,label:ot,value:st,color:it})}}}else{const l=k,r=l,c=Math.floor(e/l)-E,u=Math.ceil(o/l)+E,m=Math.floor(s/r)-E,y=Math.ceil(i/r)+E;for(let M=m;M<=y;M++)for(let v=c;v<=u;v++){const B=`${v},${M}`;let z,S,G;t.toLowerCase().includes("ulam-")?(S=K(v,M),z=String(S)):(S=v*v+M*M,z=`${v}${M>=0?"+":""}${M}i`),G=rt(v,M),T.set(B,{x:v,y:M,label:z,value:S,color:G})}}}function _(){a.clearRect(0,0,Y*h,X*h),a.save(),a.translate(p,g),a.scale(f,f);const n=A.value.toLowerCase();if(n.includes("gauss-"))a.strokeStyle="#666",a.lineWidth=1/f,a.beginPath(),a.moveTo(-Y/f,0),a.lineTo(Y/f,0),a.moveTo(0,-X/f),a.lineTo(0,X/f),a.stroke();else if(n.includes("eisen")){a.strokeStyle="#666",a.lineWidth=1/f,a.beginPath();const e=Math.max(Y,X)/f,[o,s]=j(e,0,1);a.moveTo(-o,-s),a.lineTo(o,s);const[i,l]=j(0,e,1);a.moveTo(-i,-l),a.lineTo(i,l),a.stroke()}if(n.includes("eisen")){const e=k;for(const o of T.values()){const[s,i]=j(o.x,o.y,e);o.color!=="transparent"&&ct(a,s,i,e,o.color,null,null),ct(a,s,i,e,null,"rgba(0,0,0,0.2)",1/f)}}else{const e=k;for(const o of T.values())o.color!=="transparent"&&(a.fillStyle=o.color,a.fillRect(o.x*e,o.y*e,e,e),a.strokeStyle="rgba(0,0,0,0.2)",a.lineWidth=1/f,a.strokeRect(o.x*e,o.y*e,e,e))}a.restore()}function ht(){L||(Math.abs(b)>.1||Math.abs(x)>.1?(p+=b,g+=x,b*=lt,x*=lt,P(),_()):Math.abs(b)<=.1&&Math.abs(x)<=.1&&(b!==0||x!==0)&&(b=0,x=0)),requestAnimationFrame(ht)}function $t(t,n){const e=A.value,o=(t/h-p)/f,s=(n/h-g)/f;if(e.toLowerCase().includes("eisen")){const[l,r]=D(o,s,k),c=`${l},${r}`;return T.get(c)}else{const l=Math.floor(o/k),r=Math.floor(s/k);return T.get(`${l},${r}`)}}function wt(t){if(L){d.style.display="none";const r=t.clientX-I,c=t.clientY-q;p=N+r*h,g=R+c*h,b=t.movementX*h,x=t.movementY*h,P(),_();return}const n=$t(t.clientX*h,t.clientY*h);if(!n){d.style.display="none";return}const e=A.value;let o="";if(e.toLowerCase().includes("-comet")){const r=n.value;let c=`n = ${r}`;if(e.startsWith("gauss-")?c=`${n.x}${n.y>=0?"+":""}${n.y}i
Norm = ${r}`:e.startsWith("eisen-")&&(c=`${n.x}${n.y>=0?"+":""}${n.y}ω
Norm = ${r}`),r<=2||r%2!==0)o=`${c}
(Odd or too small)`;else{const u=at(r),m=yt(r),y=m>.1?u/m:0;o=`${c}
Goldbach Pairs: ${u}
Heuristic: ${m.toFixed(2)}
Ratio: ${y.toFixed(2)}`}}else if(e.toLowerCase().includes("ulam-")){const r=n.value,c=H(r),u=J(V(r));o=`n = ${r}
Factors (excluding 1,n): ${c}
Prime factorization:
${u}`}else if(e.toLowerCase().includes("gauss-")){const r=n.x,c=n.y,u=n.value,m=Q(r,c)?"Yes":"No",y=H(u),M=J(V(u));o=`${r}${c>=0?"+":""}${c}i
Gaussian prime: ${m}
Norm = ${u}
Norm factors (excl 1,norm): ${y}
Prime factorization of norm:
${M}`}else if(e.toLowerCase().includes("eisen")){const r=n.x,c=n.y,u=n.value,m=Z(r,c)?"Yes":"No",y=H(u),M=J(V(u));o=`${r}${c>=0?"+":""}${c}ω
Eisenstein prime: ${m}
Norm = ${u}
Norm factors (excl 1,norm): ${y}
Prime factorization of norm:
${M}`}d.textContent=o,d.style.display="block";const s=12;let i=t.clientX+s,l=t.clientY+s;i+d.offsetWidth>window.innerWidth&&(i=t.clientX-d.offsetWidth-s),l+d.offsetHeight>window.innerHeight&&(l=t.clientY-d.offsetHeight-s),d.style.left=`${i}px`,d.style.top=`${l}px`}function bt(t){t.preventDefault();const n=t.clientX*h,e=t.clientY*h,o=-t.deltaY*.001;let s=f*(1+o);s=Math.min(Math.max(s,ft),ut);const i=(n-p)/f,l=(e-g)/f;p-=i*s-i*f,g-=l*s-l*f,f=s,P(),_()}function xt(t){L=!0,I=t.clientX,q=t.clientY,N=p,R=g,b=0,x=0,C.style.cursor="grabbing",d.style.display="none"}function Ct(){L=!1,C.style.cursor="grab"}function Yt(t){if(t.preventDefault(),t.touches.length===2){const n=t.touches[0],e=t.touches[1];O=Math.hypot(e.clientX-n.clientX,e.clientY-n.clientY),U=f,L=!1,d.style.display="none"}else t.touches.length===1&&(L=!0,I=t.touches[0].clientX,q=t.touches[0].clientY,N=p,R=g,b=0,x=0,d.style.display="none")}function Xt(t){if(t.preventDefault(),t.touches.length===2&&O>0){const n=t.touches[0],e=t.touches[1],o=Math.hypot(e.clientX-n.clientX,e.clientY-n.clientY),s=U*(o/O);f=Math.min(Math.max(s,ft),ut);const i=(n.clientX+e.clientX)/2,l=(n.clientY+e.clientY)/2,r=(i*h-N)/U,c=(l*h-R)/U,u=(i*h-p)/f,m=(l*h-g)/f;p+=(u-r)*f,g+=(m-c)*f,P(),_()}else if(L&&t.touches.length===1){const n=t.touches[0].clientX-I,e=t.touches[0].clientY-q;p=N+n*h,g=R+e*h,t.touches[0].previousClientX!==void 0&&(b=(t.touches[0].clientX-t.touches[0].previousClientX)*h,x=(t.touches[0].clientY-t.touches[0].previousClientY)*h),P(),_()}}function Lt(t){O=-1,t.touches.length===0?L=!1:t.touches.length===1&&(L=!0,I=t.touches[0].clientX,q=t.touches[0].clientY,N=p,R=g)}function dt(){Y=window.innerWidth,X=window.innerHeight,C.style.width=`${Y}px`,C.style.height=`${X}px`,C.width=Y*h,C.height=X*h,a.setTransform(h,0,0,h,0,0),p===0&&g===0&&(p=Y*h/2,g=X*h/2),P(),_()}A.addEventListener("change",()=>{T.clear(),P(),_()});C.addEventListener("wheel",bt,{passive:!1});C.addEventListener("mousedown",xt);window.addEventListener("mousemove",wt);window.addEventListener("mouseup",Ct);C.addEventListener("touchstart",Yt,{passive:!1});window.addEventListener("touchmove",Xt,{passive:!1});window.addEventListener("touchend",Lt);window.addEventListener("resize",dt);dt();ht();
//# sourceMappingURL=ulam2.js.map
