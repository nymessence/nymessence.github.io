<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pascal's Pyramid Visualizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <link rel="icon" href="/assets/nymessence_logo_clean.svg" type="image/svg+xml">

  <!-- Import map: map three and the specific addon specifier to final assets -->
  <script type="importmap">
  {
    "imports": {
      "three": "/assets/three.module.js",
      "three/addons/OrbitControls": "/assets/OrbitControls.js",
      "three/addons/PointerLockControls": "/assets/PointerLockControls.js",
      "three/addons/ConvexGeometry": "/assets/ConvexGeometry.js"
    }
  }
  </script>

  <!-- Preload & main JS (deployed assets path) -->
  <link rel="modulepreload" href="/assets/pascals-pyramid.js" crossorigin>
  <script type="module" src="/assets/pascals-pyramid.js" crossorigin></script>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/pascals-pyramid.css">
</head>

<body>
  <!-- Main 3D canvas container -->
  <div id="container" class="canvas-container"></div>

  <!-- UI Sidebar -->
  <aside id="ui" role="complementary" aria-label="Control Panel">
    <div class="ui-content">
      <header>
        <strong>Pascal's Pyramid Explorer</strong>
        <button id="toggleUI">Hide UI</button>
      </header>

      <div class="scroll-hint">â†“ Scroll for more controls</div>

      <label>
        Radius: <span id="radiusValue">100</span>
        <input type="range" id="radiusSlider" min="10" max="200" value="100">
      </label>
      <br />
      <button id="xrayToggle">Toggle X-Ray</button>

      <hr />

      <p>Controls:</p>
      <ul>
        <li>Fly: W A S D R F</li>
        <li>Mouse drag / touch drag: Look around</li>
        <li>Mobile joystick + tilt supported</li>
      </ul>
    </div>
  </aside>

  <!-- Mobile Joystick Areas -->
  <div id="joystick" class="joystick"></div>
  <div id="look" class="look"></div>

  <!-- MOBILE TOUCH FIX -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const ui = document.getElementById('ui');
    const container = document.getElementById('container');

    let isScrollingUI = false;

    ui.addEventListener('touchstart', () => { isScrollingUI = true; }, { passive: true });
    ui.addEventListener('touchend', () => { setTimeout(()=>{isScrollingUI=false;},100); });

    container.addEventListener('touchstart', e => { if(isScrollingUI) e.preventDefault(); }, { passive: false });
    container.addEventListener('touchmove', e => { if(isScrollingUI) e.preventDefault(); }, { passive: false });

    ui.addEventListener('touchstart', e => { if(e.target.closest('#ui')) document.body.style.overflow = 'auto'; }, { passive: true });
    ui.addEventListener('touchend', () => { document.body.style.overflow = ''; });
  });
  </script>
</body>
</html>

