<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>4D Polytope Visualizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    
    <link rel="icon" href="../logo/nymessence_logo_clean.svg" type="image/svg+xml">
    <link rel="stylesheet" href="../styles/polytopes.css" />

    <script type="importmap">
    {
        "imports": {
            "three": "../node_modules/three/build/three.module.js",
            "three/addons/": "../node_modules/three/examples/jsm/"
        }
    }
    </script>
</head>

<body>
    <!-- Main 3D canvas container -->
    <div id="container" class="canvas-container"></div>

    <!-- UI Sidebar -->
    <aside id="ui" role="complementary" aria-label="Control Panel">
        <div class="ui-content">
            <header>
                <strong>4D Polytope Visualizer</strong>
                <button id="toggleUI">Hide UI</button>
                <button id="fullscreenBtn">Full screen</button>
            </header>

            <div class="scroll-hint">â†“ Scroll for more controls</div>

            <label for="polytopeSelect">
                Select Polytope
                <select id="polytopeSelect" name="polytopeSelect">
                    <option value="4-simplex">4-simplex</option>
                    <option value="hypercube">Hypercube</option>
                    <option value="16-cell">16 Cell</option>
                    <option value="24-cell" selected>24 Cell</option>
                    <option value="120-cell">120 Cell</option>
                    <option value="600-cell">600 Cell</option>
                </select>
            </label>
            <hr />

            <label>
                <input type="checkbox" id="showVerts" checked />
                Show Vertices
            </label>
            <label>
                Vertex Color
                <input type="color" id="vertColor" value="#ffcc00" />
            </label>
            <label>
                Vertex Size
                <input type="range" id="vertSize" min="0.01" max="0.2" step="0.005" value="0.05" />
            </label>
            <hr />

            <label>
                <input type="checkbox" id="showEdges" checked />
                Show Edges
            </label>
            <label>
                Edge Color
                <input type="color" id="edgeColor" value="#44aaff" />
            </label>
            <label>
                Edge Opacity
                <input type="range" id="edgeOpacity" min="0" max="1" step="0.01" value="0.9" />
            </label>
            <hr />

            <label>
                <input type="checkbox" id="showFaces" />
                Show Faces
            </label>
            <label>
                Face Color
                <input type="color" id="faceColor" value="#aa44ff" />
            </label>
            <label>
                Face Opacity
                <input type="range" id="faceOpacity" min="0" max="1" step="0.01" value="0.3" />
            </label>
            <hr />

            <label for="projectionType">
                Projection Type
                <select id="projectionType" name="projectionType">
                    <option value="perspective" selected>Perspective</option>
                    <option value="parallel">Parallel</option>
                </select>
            </label>
            <hr />

            <strong>4D Rotations</strong>
            <label>
                XY Rotation
                <input type="range" id="rotXY" min="0" max="6.28318" step="0.01" value="0" />
            </label>
            <label>
                XZ Rotation
                <input type="range" id="rotXZ" min="0" max="6.28318" step="0.01" value="0" />
            </label>
            <label>
                YZ Rotation
                <input type="range" id="rotYZ" min="0" max="6.28318" step="0.01" value="0" />
            </label>
            <label>
                XW Rotation
                <input type="range" id="rotXW" min="0" max="6.28318" step="0.01" value="0" />
            </label>
            <label>
                YW Rotation
                <input type="range" id="rotYW" min="0" max="6.28318" step="0.01" value="0" />
            </label>
            <label>
                ZW Rotation
                <input type="range" id="rotZW" min="0" max="6.28318" step="0.01" value="0" />
            </label>
            <hr />

            <label for="renderMode">
                High-res Render Mode
                <select id="renderMode" name="renderMode">
                    <option value="png">Large PNG export</option>
                    <option value="samples">Multisample average render</option>
                </select>
            </label>
            <label>
                Resolution Multiplier
                <input type="number" id="resMult" min="1" max="4" step="1" value="2" style="width: 50px;" />
            </label>
            <label>
                Samples (multisample)
                <input type="number" id="samples" min="1" max="64" step="1" value="8" style="width: 50px;" />
            </label>
            <button id="renderBtn">Generate High-Res Image</button>
            <div id="progress" aria-live="polite" style="margin-top:8px; font-size: 12px; color: #aaa;"></div>
        </div>
    </aside>

    <footer role="contentinfo">
        Rotate 3D with mouse drag, zoom with wheel.<br />
        Use sliders to control 4D rotation planes.
    </footer>

    <!-- Remove event blocker script entirely -->
    <!-- No need for DOMContentLoaded workaround -->
    <script>
      // MOBILE TOUCH FIX: Prevent canvas from stealing scroll
        document.addEventListener('DOMContentLoaded', () => {
            const ui = document.getElementById('ui');
            const container = document.getElementById('container');

            // Prevent touchmove on canvas IF user is scrolling the UI
            let isScrollingUI = false;

            ui.addEventListener('touchstart', () => {
                isScrollingUI = true;
            }, { passive: true });

            ui.addEventListener('touchend', () => {
                setTimeout(() => { isScrollingUI = false; }, 100);
            });

            container.addEventListener('touchstart', (e) => {
                if (isScrollingUI) e.preventDefault();
            }, { passive: false });

            container.addEventListener('touchmove', (e) => {
                if (isScrollingUI) e.preventDefault();
            }, { passive: false });

            // Optional: Re-enable body scroll only for UI interaction
            ui.addEventListener('touchstart', (e) => {
                if (e.target.closest('#ui')) {
                    document.body.style.overflow = 'auto';
                }
            }, { passive: true });

            ui.addEventListener('touchend', () => {
                document.body.style.overflow = '';
            });
        });
    </script>

    <!-- Main app script -->
    <script type="module" src="../js/polytopes.js"></script>
</body>
</html>
